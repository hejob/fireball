(function(){function _getPropertyDescriptor(a,b){if(a){var c=Object.getOwnPropertyDescriptor(a,b);return c||_getPropertyDescriptor(Object.getPrototypeOf(a),b)}}function _copyprop(a,b,c){var d=_getPropertyDescriptor(b,a);Object.defineProperty(c,a,d)}function _isDomNode(a){return"object"==typeof Node?a instanceof Node:a&&"object"==typeof a&&"number"==typeof a.nodeType&&"string"==typeof a.nodeName}function _initClass(a,b){for(var c in _metaClass)Object.defineProperty(b,c,{value:_metaClass[c],writable:"__props__"===c,enumerable:"__props__"===c})}function _createCtor(a,b){var c;Fire._isFireClass(b)?(c=b.__ctors__,c&&(c=c.slice())):b&&(c=[b]),c?a&&c.push(a):a&&(c=[a]);var d;if(c)switch(c.length){case 1:d=function(){_createInstanceProps(this,d);var a=d.__ctors__;a[0].apply(this,arguments)};break;case 2:d=function(){_createInstanceProps(this,d);var a=d.__ctors__;a[0].apply(this,arguments),a[1].apply(this,arguments)};break;case 3:d=function(){_createInstanceProps(this,d);var a=d.__ctors__;a[0].apply(this,arguments),a[1].apply(this,arguments),a[2].apply(this,arguments)};break;case 4:d=function(){_createInstanceProps(this,d);var a=d.__ctors__;a[0].apply(this,arguments),a[1].apply(this,arguments),a[2].apply(this,arguments),a[3].apply(this,arguments)};break;default:d=function(){_createInstanceProps(this,d);for(var a=d.__ctors__,b=0,c=a.length;c>b;++b)a[b].apply(this,arguments)}}else d=function(){_createInstanceProps(this,d)};return Object.defineProperty(d,"__ctors__",{value:c||null,writable:!1,enumerable:!1}),d}function parseAttributes(a,b,c){function d(b,c,d){var f=a[b];f&&typeof f===c&&e.push("function"==typeof d?d(f):d)}tmpAttrs.length=0;var e=tmpAttrs,f=a.type;f&&(f===Fire.Integer?e.push(Fire.Integer_Obsoleted):f===Fire.Float||f===Number?e.push(Fire.Float_Obsoleted):f===Fire.Boolean||f===Boolean?e.push(Fire.Boolean_Obsoleted):f===Fire.String||f===String?e.push(Fire.String_Obsoleted):"Object"===f||f===Object||("object"==typeof f?f.hasOwnProperty("__enums__")&&e.push(Fire.Enum(f)):"function"==typeof f&&e.push(Fire.ObjectType(f)))),d("rawType","string",Fire.RawType),d("editorOnly","boolean",Fire.EditorOnly),d("displayName","string",Fire.DisplayName),d("multiline","boolean",Fire.MultiText),d("readonly","boolean",Fire.ReadOnly),d("tooltip","string",Fire.Tooltip),a.serializable===!1&&e.push(Fire.NonSerialized);var g=a.visible;"undefined"!=typeof g?a.visible||e.push(Fire.HideInInspector):95===c.charCodeAt(0)&&e.push(Fire.HideInInspector);var h=a.range;h&&Array.isArray(h)&&h.length>=2&&e.push(Fire.Range(h[0],h[1]));var i=a.nullable;if(i&&"object"==typeof i){var j=i.propName;if("string"==typeof j){var k=i["default"];"boolean"==typeof k&&e.push(Fire.Nullable(j,k))}}var l=a.watch;if(l&&"object"==typeof l)for(var m in l){var n=l[m];"function"==typeof n&&e.push(Fire.Watch(m.split(" "),n))}return e}function ImageLoader(a,b,c){var d=document.createElement("img");d.crossOrigin="Anonymous";var e=function(){b&&b(null,this),d.removeEventListener("load",e),d.removeEventListener("error",f),d.removeEventListener("progress",c)},f=function(a,g,h){if(b){var i="Failed to load image: "+a+" Url: "+h;b(i,null)}d.removeEventListener("load",e),d.removeEventListener("error",f),d.removeEventListener("progress",c)};return d.addEventListener("load",e),d.addEventListener("error",f),c&&d.addEventListener("progress",c),d.src=a,d}function _LoadFromXHR(a,b,c,d){var e=new XMLHttpRequest,f=-1;e.onreadystatechange=function(){e.readyState===e.DONE?(b&&(200===e.status||0===e.status?b(null,e):b('LoadFromXHR: Could not load "'+a+'", status: '+e.status,null)),e.onreadystatechange=null,g&&e.removeEventListener("progress",g)):(!c||e.readyState!==e.LOADING||"onprogress"in e||(-1===f&&(f=e.getResponseHeader("Content-Length")),c(e.responseText.length,f)),c&&e.readyState===e.HEADERS_RECEIVED&&(f=e.getResponseHeader("Content-Length")))},e.open("GET",a,!0),d&&(e.responseType=d);var g;c&&"onprogress"in e&&(g=function(a){a.lengthComputable&&c(a.loaded,a.total)},e.addEventListener("progress",onprogress)),e.send()}function TextLoader(a,b,c){var d=b&&function(c,d){d&&d.responseText?b(null,d.responseText):b('TextLoader: "'+a+'" seems to be unreachable or the file is empty. InnerMessage: '+c,null)};_LoadFromXHR(a,d,c)}function JsonLoader(a,b,c){var d=b&&function(c,d){if(d&&d.responseText){var e;try{e=JSON.parse(d.responseText)}catch(f){return void b(f,null)}b(null,e)}else b('JsonLoader: "'+a+'" seems to be unreachable or the file is empty. InnerMessage: '+c,null)};_LoadFromXHR(a,d,c)}function ContainerStrategy(){}function ContentStrategy(){}function _getStyle(a){return a.bitmapFont&&a.bitmapFont._uuid?{font:a.bitmapFont.size+" "+a.bitmapFont._uuid,align:Fire.TextAlign[a.align].toLowerCase()}:{font:"1 "+defaultFace,align:"left"}}function _setStyle(a){var b=_getStyle(a);a._renderObj&&a._renderObj.setStyle(b),a._renderObjInScene&&a._renderObjInScene.setStyle(b)}function _getNewMatrix23(a,b){var c=new Fire.Matrix23;return c.a=a.scale.x,c.b=0,c.c=0,c.d=a.scale.y,c.tx=a.position.x,c.ty=-a.position.y,c.prepend(b),c.b=-c.b,c.c=-c.c,c.ty=Fire.Engine._curRenderContext.renderer.height-c.ty,c}function _registerFont(a){var b={};if(a&&a._uuid){if(b.face=a._uuid,b.size=a.size,b.lineHeight=a.lineHeight,b.chars={},a.texture)for(var c=new PIXI.BaseTexture(a.texture.image),d=a.charInfos,e=d.length,f=0;e>f;f++){var g=d[f],h=g.id,i=new PIXI.Rectangle(g.x,g.y,g.width,g.height);if(i.x+i.width>c.width||i.y+i.height>c.height){Fire.error("Character in %s does not fit inside the dimensions of texture %s",a.name,a.texture.name);break}var j=new PIXI.Texture(c,i);b.chars[h]={xOffset:g.xOffset,yOffset:g.yOffset,xAdvance:g.xAdvance,kerning:{},texture:j}}else Fire.error("Invalid texture of bitmapFont: %s",a.name);for(var k=a.kernings,l=0;l<k.length;l++){var m=k[l],n=m.first,o=m.second,p=m.amount;b.chars[o].kerning[n]=p}}else b=tempData;PIXI.BitmapText.fonts[b.face]=b}function _getTextStyle(a){if(a._renderObj||a._renderObjInScene){var b={fill:"#"+a.color.toHEX("#rrggbb"),align:Fire.TextAlign[a.align].toLowerCase()};return b.font=a.fontType!==Fire.Text.FontType.Custom?a.size+"px "+Fire.Text.FontType[a.fontType].toLowerCase():a.size+"px "+a.customFontType,b}return{font:"30px Arial",fill:"white",align:"left"}}var root=this,Fire=root.Fire||{},Editor=root.Editor||{};if(Fire.Editor=Editor,Fire.isNode=!("undefined"==typeof process||!process.versions||!process.versions.node),Fire.isNodeWebkit=!!(Fire.isNode&&"node-webkit"in process.versions),Fire.isAtomShell=!!(Fire.isNode&&"atom-shell"in process.versions),Fire.isApp=Fire.isNodeWebkit||Fire.isAtomShell,Fire.isPureWeb=!Fire.isNode&&!Fire.isApp,Fire.isEditor=Fire.isApp,Fire.isWeb=Fire.isAtomShell?"undefined"!=typeof process&&"renderer"===process.type:"undefined"==typeof __dirname||null===__dirname,Fire.isEditorCore=Fire.isApp&&!Fire.isWeb,Fire.isNode)Fire.isDarwin="darwin"===process.platform,Fire.isWin32="win32"===process.platform;else{var platform=window.navigator.platform;Fire.isDarwin="Mac"===platform.substring(0,3),Fire.isWin32="Win"===platform.substring(0,3)}if(Fire.isPureWeb){var win=window,nav=win.navigator,doc=document,docEle=doc.documentElement,ua=nav.userAgent.toLowerCase();Fire.isMobile=-1!==ua.indexOf("mobile")||-1!==ua.indexOf("android"),Fire.isIOS=!!ua.match(/(iPad|iPhone|iPod)/i),Fire.isAndroid=!(!ua.match(/android/i)&&!nav.platform.match(/android/i))}else Fire.isAndroid=Fire.isIOS=Fire.isMobile=!1;Object.defineProperty(Fire,"isRetina",{get:function(){return Fire.isWeb&&window.devicePixelRatio&&window.devicePixelRatio>1}}),Fire.isRetinaEnabled=(Fire.isIOS||Fire.isDarwin)&&!Fire.isEditor&&Fire.isRetina;var Destroyed=1,ToDestroy=2,DontSave=4,EditorOnly=8,Dirty=16,DontDestroy=32,ObjectFlags={DontSave:DontSave,EditorOnly:EditorOnly,Dirty:Dirty,DontDestroy:DontDestroy,Destroying:512,HideInGame:1024,HideInEditor:2048,IsOnEnableCalled:4096,IsOnLoadCalled:8192,IsOnStartCalled:16384,IsEditorOnEnabledCalled:32768};ObjectFlags.Hide=ObjectFlags.HideInGame|ObjectFlags.HideInEditor,Fire._ObjectFlags=ObjectFlags;var PersistentMask=~(ToDestroy|Dirty|ObjectFlags.Destroying|DontDestroy|ObjectFlags.IsOnEnableCalled|ObjectFlags.IsEditorOnEnabledCalled|ObjectFlags.IsOnLoadCalled|ObjectFlags.IsOnStartCalled),JS=Fire.JS={addon:function(a){"use strict";a=a||{};for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];for(var e in d)e in a||_copyprop(e,d,a)}return a},mixin:function(a){"use strict";a=a||{};for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];if(d){if("object"!=typeof d){Fire.error("Fire.mixin called on non-object:",d);continue}for(var e in d)_copyprop(e,d,a)}}return a},extend:function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a},clear:function(a){for(var b=Object.keys(a),c=0;c<b.length;c++)delete a[b[c]]}};JS.getClassName=function(a){if("function"==typeof a&&a.prototype.__classname__)return a.prototype.__classname__;if(a&&a.constructor){if(a.constructor.prototype&&a.constructor.prototype.hasOwnProperty("__classname__"))return a.__classname__;var b;if(a.constructor.name&&(b=a.constructor.name),a.constructor.toString){var c,d=a.constructor.toString();c=d.match("["===d.charAt(0)?/\[\w+\s*(\w+)\]/:/function\s*(\w+)/),c&&2===c.length&&(b=c[1])}return"Object"!==b?b:null}return null},function(){function a(a,b){return function(c,d){if(d.prototype.hasOwnProperty(a)&&delete b[d.prototype[a]],d.prototype[a]=c,c){var e=b[c];if(e&&e!==d){var f="A Class already exists with the same "+a+' : "'+c+'".';Fire.error(f)}else b[c]=d}}}var b={},c={};JS._setClassId=a("__cid__",b);var d=a("__classname__",c);JS.setClassName=function(a,b){d(a,b),a&&!b.prototype.hasOwnProperty("__cid__")&&JS._setClassId(a,b)},JS.unregisterClass=function(){"use strict";for(var a=0;a<arguments.length;a++){var d=arguments[a].prototype,e=d.__cid__;e&&delete b[e];var f=d.__classname__;f&&delete c[f]}},JS._getClassById=function(a){var c=b[a];return c},JS.getClassByName=function(a){return c[a]},JS._getClassId=function(a){return"function"==typeof a&&a.prototype.__cid__?a.prototype.__cid__:a&&a.constructor&&a.constructor.prototype&&a.constructor.prototype.hasOwnProperty("__cid__")?a.__cid__:""}}(),JS.getset=function(a,b,c,d){Object.defineProperty(a,b,{get:c,set:d})},JS.get=function(a,b,c){Object.defineProperty(a,b,{get:c})},JS.set=function(a,b,c){Object.defineProperty(a,b,{set:c})},Fire.log=function(){console.log.apply(console,arguments)},Fire.info=function(){(console.info||console.log).apply(console,arguments)},Fire.warn=function(){console.warn.apply(console,arguments)},Fire.error=console.error.bind?console.error.bind(console):function(){console.error.apply(console,arguments)},Fire.defineEnum=function(a){var b={};Object.defineProperty(b,"__enums__",{value:void 0,writable:!0});var c=-1;for(var d in a){var e=a[d];-1===e?e=++c:c=e,b[d]=e;var f=""+e;d!==f&&Object.defineProperty(b,f,{value:d,enumerable:!1})}return b},function(){var a=Math.PI/180,b=180/Math.PI;JS.mixin(Math,{TWO_PI:2*Math.PI,HALF_PI:.5*Math.PI,deg2rad:function(b){return b*a},rad2deg:function(a){return a*b},rad180:function(a){return(a>Math.PI||a<-Math.PI)&&(a=(a+Math.TOW_PI)%Math.TOW_PI),a},rad360:function(a){return a>Math.TWO_PI?a%Math.TOW_PI:0>a?Math.TOW_PI+a%Math.TOW_PI:a},deg180:function(a){return(a>180||-180>a)&&(a=(a+360)%360),a},deg360:function(a){return a>360?a%360:0>a?360+a%360:a},randomRange:function(a,b){return Math.random()*(b-a)+a},randomRangeInt:function(a,b){return Math.floor(this.randomRange(a,b))},clamp:function(a,b,c){return"number"!=typeof b?void Fire.error("[clamp] min value must be type number"):"number"!=typeof c?void Fire.error("[clamp] max value must be type number"):b>c?void Fire.error("[clamp] max value must not less than min value"):Math.min(Math.max(a,b),c)},clamp01:function(a){return Math.min(Math.max(a,0),1)},calculateMaxRect:function(a,b,c,d,e){var f=Math.min(b.x,c.x,d.x,e.x),g=Math.max(b.x,c.x,d.x,e.x),h=Math.min(b.y,c.y,d.y,e.y),i=Math.max(b.y,c.y,d.y,e.y);return a.x=f,a.y=h,a.width=g-f,a.height=i-h,a}})}(),Fire.Intersection=function(){function a(a,b,c,d){var e=(d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x),f=(b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x),g=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);if(0!==g){var h=e/g,i=f/g;if(h>=0&&1>=h&&i>=0&&1>=i)return!0}return!1}function b(b,c,d){var e=new Fire.Vec2(d.x,d.y),f=new Fire.Vec2(d.x,d.yMax),g=new Fire.Vec2(d.xMax,d.yMax),h=new Fire.Vec2(d.xMax,d.y);return a(b,c,e,f)?!0:a(b,c,f,g)?!0:a(b,c,g,h)?!0:a(b,c,h,e)?!0:!1}function c(b,c,d){for(var e=d.points.length,f=0;e>f;++f){var g=d.points[f],h=d.points[(f+1)%e];if(a(b,c,g,h))return!0}return!1}function d(a,b){var c=a.x,d=a.y,e=a.x+a.width,f=a.y+a.height,g=b.x,h=b.y,i=b.x+b.width,j=b.y+b.height;return i>=c&&e>=g&&j>=d&&f>=h}function e(a,b){var d,e=new Fire.Vec2(a.x,a.y),f=new Fire.Vec2(a.x,a.yMax),g=new Fire.Vec2(a.xMax,a.yMax),h=new Fire.Vec2(a.xMax,a.y);if(c(e,f,b))return!0;if(c(f,g,b))return!0;if(c(g,h,b))return!0;if(c(h,e,b))return!0;for(d=0;d<b.points.length;++d)if(a.contains(b.points[d]))return!0;return b.contains(e)?!0:b.contains(f)?!0:b.contains(g)?!0:b.contains(h)?!0:!1}function f(a,b){var d;for(d=0;d<length;++d){var e=a.points[d],f=a.points[(d+1)%length];if(c(e,f,b))return!0}for(d=0;d<b.points.length;++d)if(a.contains(b.points[d]))return!0;for(d=0;d<a.points.length;++d)if(b.contains(a.points[d]))return!0;return!1}var g={};return g.lineLine=a,g.lineRect=b,g.linePolygon=c,g.rectRect=d,g.rectPolygon=e,g.polygonPolygon=f,g}(),function(){var a=function(){this._callbackTable={}};Fire._CallbacksHandler=a,a.prototype.add=function(a,b){var c=this._callbackTable[a];return"undefined"!=typeof c?(b&&(null!==c?c.push(b):(c=[b],this._callbackTable[a]=c)),!1):(c=b?[b]:null,this._callbackTable[a]=c,!0)},a.prototype.has=function(a,b){var c=this._callbackTable[a];return c&&c.length>0?b?-1!==c.indexOf(b):!0:!1},a.prototype.removeAll=function(a){delete this._callbackTable[a]},a.prototype.remove=function(a,b){var c=this._callbackTable[a];if(c){var d=c.indexOf(b);if(-1!==d)return c.splice(d,1),!0}return!1};var b=function(){this._callbackTable={}};return JS.extend(b,a),Fire.CallbacksInvoker=b,b.prototype.invoke=function(a,b,c,d,e,f){var g=this._callbackTable[a];if(g)for(var h=0;h<g.length;h++)g[h](b,c,d,e,f)},b.prototype.invokeAndRemove=function(a,b,c,d,e,f){var g=this._callbackTable[a];if(g)for(var h=0;h<g.length;h++)g[h](b,c,d,e,f);this.removeAll(a)},b.prototype.bindKey=function(a,b){var c=this;return function(d,e,f,g,h){var i=c._callbackTable[a];if(i)for(var j=0;j<i.length;j++)i[j](d,e,f,g,h);b&&c.removeAll(a)}},b}(),Fire.padLeft=function(a,b,c){return a=a.toString(),b-=a.length,b>0?new Array(b+1).join(c)+a:a},Fire.fitRatio=function(a,b,c){var d,e;return a>1?(d=b,e=d/a):(e=c,d=e*a),Fire.fitSize(d,e,b,c)},Fire.fitSize=function(a,b,c,d){var e,f;return a>c&&b>d?(e=c,f=b*c/a,f>d&&(f=d,e=a*d/b)):a>c?(e=c,f=b*c/a):b>d?(e=a*d/b,f=d):(e=a,f=b),[e,f]},Fire.getEnumList=function(a){if(void 0!==a.__enums__)return a.__enums__;var b=[];for(var c in a)if(a.hasOwnProperty(c)){var d=a[c],e="number"==typeof d&&(0|d)===d;e&&b.push({name:c,value:d})}return b.sort(function(a,b){return a.value-b.value}),a.__enums__=b,b},Fire.getVarFrom=function(a,b){for(var c=b.split("."),d=a,e=0;e<c.length;++e){var f=c[e];if(d=d[f],void 0===d||null===d)return null}return d},Fire.rgb2hsv=function(a,b,c){var d={h:0,s:0,v:0},e=Math.max(a,b,c),f=Math.min(a,b,c),g=0;return d.v=e,d.s=e?(e-f)/e:0,d.s?(g=e-f,d.h=a===e?(b-c)/g:b===e?2+(c-a)/g:4+(a-b)/g,d.h/=6,d.h<0&&(d.h+=1)):d.h=0,d},Fire.hsv2rgb=function(a,b,c){var d={r:0,g:0,b:0};if(0===b)d.r=d.g=d.b=c;else if(0===c)d.r=d.g=d.b=0;else{1===a&&(a=0),a*=6,b=b,c=c;var e=Math.floor(a),f=a-e,g=c*(1-b),h=c*(1-b*f),i=c*(1-b*(1-f));switch(e){case 0:d.r=c,d.g=i,d.b=g;break;case 1:d.r=h,d.g=c,d.b=g;break;case 2:d.r=g,d.g=c,d.b=i;break;case 3:d.r=g,d.g=h,d.b=c;break;case 4:d.r=i,d.g=g,d.b=c;break;case 5:d.r=c,d.g=g,d.b=h}}return d},Fire.attr=function(a,b,c){var d,e,f,g="_attr$"+b;if("function"==typeof a){if(d=a.prototype,e=d[g],"undefined"!=typeof c){if("object"!=typeof c)return d[g]=c,c;e||(d[g]=e={});for(f in c)"_"!==f[0]&&(e[f]=c[f])}return e}if(d=a,"undefined"!=typeof c){if("object"==typeof c){d.hasOwnProperty(g)&&(e=d[g]),e||(d[g]=e={});for(f in c)"_"!==f[0]&&(e[f]=c[f]);return JS.addon({},e,d.constructor.prototype[g])}return d[g]=c,c}return e=d[g],"object"==typeof e?JS.addon({},e,d.constructor.prototype[g]):e},Fire.NonSerialized={serializable:!1,_canUsedInGetter:!1},Fire.EditorOnly={editorOnly:!0,_canUsedInGetter:!1},Fire.Integer="Integer",Fire.Integer_Obsoleted={type:"int"},Fire.Float="Float",Fire.Float_Obsoleted={type:"float"},Fire.SingleText={textMode:"single"},Fire.MultiText={textMode:"multi"},Fire.Boolean="Boolean",Fire.Boolean_Obsoleted={type:"boolean"},Fire.String="String",Fire.String_Obsoleted={type:"string"},Object.defineProperty(Fire,"_ScriptUuid",{get:function(){var a=Fire.ObjectType(Fire.ScriptAsset);return a.type="script-uuid",a}}),Fire.ObjectType=function(a){return{type:"object",ctor:a}},Fire.Enum=function(a){return{type:"enum",enumList:Fire.getEnumList(a)}},Fire.RawType=function(a){var b=["image","json","text","audio"];return{rawType:a,serializable:!1,_canUsedInGetter:!1,_onAfterProp:function(a,c){var d=Fire.attr(a,c)||{},e=-1!==b.indexOf(d.rawType);e&&a.prop("_rawext","",Fire.HideInInspector)}}},Fire.Custom=function(a){return{custom:a}},Fire.HideInInspector={hideInInspector:!0},Fire.DisplayName=function(a){return{displayName:a}},Fire.ReadOnly={readOnly:!0},Fire.Tooltip=function(a){return{tooltip:a}},Fire.Nullable=function(a,b){return{nullable:a,_onAfterProp:function(c,d){c.prop(a,b,Fire.HideInInspector);var e=Fire.attr(c,d)||{};e.serializable===!1?Fire.attr(c,a,Fire.NonSerialized):e.editorOnly&&Fire.attr(c,a,Fire.EditorOnly)}}},Fire.Watch=function(a,b){return{watch:[].concat(a),watchCallback:b}},Fire.Range=function(a,b){return{min:a,max:b}};var _appendProp=function(a){if(this.__props__){var b=this.__props__.indexOf(a);0>b&&this.__props__.push(a)}else this.__props__=[a]},_metaClass={__props__:null,prop:function(a,b,c){"use strict";if(Fire.attr(this,a,{"default":b}),_appendProp.call(this,a),c){for(var d=null,e=2,f=e;f<arguments.length;f++){var g=arguments[f];Fire.attr(this,a,g),g._onAfterProp&&(d=d||[],d.push(g._onAfterProp))}if(d)for(var h=0;h<d.length;h++)d[h](this,a)}return this},get:function(a,b,c){"use strict";if(c)for(var d=2,e=d;e<arguments.length;e++){var f=arguments[e];Fire.attr(this,a,f)}return Fire.attr(this,a,Fire.NonSerialized),Object.defineProperty(this.prototype,a,{get:b,configurable:!0}),this},set:function(a,b){return Object.defineProperty(this.prototype,a,{set:b,configurable:!0}),this},getset:function(a,b,c,d){"use strict";if(d){var e=[].slice.call(arguments);e.splice(2,1),this.get.apply(this,e)}else this.get(a,b);return this.set(a,c),this}},_createInstanceProps=function(a,b){var c=b.__props__;if(c)for(var d=0;d<c.length;d++){var e=c[d],f=Fire.attr(b,e);if(f&&f.hasOwnProperty("default")){var g=f["default"];"object"==typeof g&&g&&(g=g.clone?g.clone():Array.isArray(g)?[]:{}),a[e]=g}}};Fire._isFireClass=function(a){return!!a&&a.prop===_metaClass.prop},Fire.isChildClassOf=function(a,b){if(a&&b){if("function"!=typeof a)return!1;if("function"!=typeof b)return!1;for(;a&&a.$super;a=a.$super)if(a===b)return!0;if(a===b)return!0;for(var c=Object.getPrototypeOf(a.prototype);c;){if(a=c.constructor,a===b)return!0;c=Object.getPrototypeOf(a.prototype)}}return!1},Fire._doDefine=function(a,b,c){var d=_createCtor(c,b);return _initClass(a,d),b&&(JS.extend(d,b),d.$super=b,b.__props__&&(d.__props__=b.__props__.slice())),JS.setClassName(a,d),d},Fire.define=function(a,b){return Fire.extend(a,null,b)},Fire.extend=function(a,b,c){return"function"==typeof a&&(c=b,b=a,a=""),"string"==typeof a?Fire._doDefine(a,b,c):"undefined"==typeof a?Fire._doDefine("",b,c):null},Fire._fastDefine=function(a,b,c){JS.setClassName(a,b),b.__props__=c;for(var d=0;d<c.length;d++)Fire.attr(b,c[d],Fire.HideInInspector)},Fire.Class=function(a){if(0===arguments.length)return Fire.define();if(!a)return Fire.error("[Fire.Class] Option must be non-nil"),Fire.define();var b,c=a.name,d=a["extends"],e=a.hasOwnProperty("constructor")&&a.constructor||void 0;d?c?b=Fire.extend(c,d,e):(b=Fire.extend(d,e),c=Fire.JS.getClassName(b)):c?b=Fire.define(c,e):(b=Fire.define(e),c=Fire.JS.getClassName(b));var f=a.properties;if(f)for(var g in f){var h=f[g],i=h&&"object"==typeof h&&!Array.isArray(h),j=i&&h.constructor==={}.constructor;j||(h={"default":h});var k=parseAttributes(h,c,g);if(h.hasOwnProperty("default"))b.prop.apply(b,[g,h["default"]].concat(k));else{var l=h.get,m=h.set;l&&b.get.apply(b,[g,l].concat(k)),m&&b.set(g,m)}}var n=a.statics;if(n)for(var o in n)b[o]=n[o];var p=["name","extends","constructor","properties","statics"];for(var q in a)if(-1===p.indexOf(q)){var r=a[q],s=typeof r;"function"===s&&(b.prototype[q]=r)}return b};var tmpAttrs=[];Fire.Path=Fire.isNode?require("path"):function(){var a;if(Fire.isWin32){var b=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,c=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/;a=function(a){var d=b.exec(a),e=(d[1]||"")+(d[2]||""),f=d[3]||"",g=c.exec(f),h=g[1],i=g[2],j=g[3];return[e,h,i,j]}}else{var d=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;a=function(a){return d.exec(a).slice(1)}}return path={basename:function(a){return a.replace(/^.*(\\|\/|\:)/,"")},extname:function(a){return a.substring((~-a.lastIndexOf(".")>>>0)+1)},dirname:function(b){var c=a(b),d=c[0],e=c[1];return d||e?(e&&(e=e.substr(0,e.length-1)),d+e):"."},sep:Fire.isWin32?"\\":"/"},path}(),Fire.Path.setExtname=function(a,b){var c=(~-a.lastIndexOf(".")>>>0)+1;return a.substring(0,c)+b},Fire.Path.setEndWithSep=function(a,b){b="undefined"!=typeof b?b:!0;var c=a[a.length-1],d="\\"===c||"/"===c;return!d&&b?a+=Fire.Path.sep:d&&!b&&(a=a.substring(0,a.length-1)),a},FObject=function(){function a(){this._name="",this._objFlags=0}Fire._fastDefine("Fire.FObject",a,["_name","_objFlags"]);var b=[];return Object.defineProperty(a,"_deferredDestroy",{value:function(){for(var a=b.length,c=0;a>c;++c){var d=b[c];d._objFlags&Destroyed||d._destroyImmediate()}a===b.length?b.length=0:b.splice(0,a)},enumerable:!1}),Object.defineProperty(a.prototype,"name",{get:function(){return this._name},set:function(a){this._name=a},enumerable:!1}),Object.defineProperty(a.prototype,"isValid",{get:function(){return!(this._objFlags&Destroyed)}}),a.prototype.destroy=function(){return this._objFlags&Destroyed?(Fire.error("object already destroyed"),!1):this._objFlags&ToDestroy?!1:(this._objFlags|=ToDestroy,b.push(this),!0)},a.prototype._destruct=function(){for(var a in this)if(this.hasOwnProperty(a)){var b=typeof this[a];switch(b){case"string":this[a]="";break;case"object":this[a]=null;break;case"function":this[a]=null}}},a.prototype._onPreDestroy=null,a.prototype._destroyImmediate=function(){return this._objFlags&Destroyed?void Fire.error("object already destroyed"):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),void(this._objFlags|=Destroyed))},a}(),Fire.isValid=function(a){return!(!a||a._objFlags&Destroyed)},Fire.FObject=FObject;var HashObject=function(){var a=Fire.extend("Fire.HashObject",Fire.FObject,function(){Object.defineProperty(this,"_hashCode",{value:0,writable:!0,enumerable:!1}),Object.defineProperty(this,"_id",{value:"",writable:!0,enumerable:!1})}),b=0;return Object.defineProperty(a.prototype,"hashCode",{get:function(){return this._hashCode||(this._hashCode=++b)}}),Object.defineProperty(a.prototype,"id",{get:function(){return this._id||(this._id=""+this.hashCode)}}),a}();Fire.HashObject=HashObject,Vec2=function(){function a(a,b){this.x="number"==typeof a?a:0,this.y="number"==typeof b?b:0}return JS.setClassName("Fire.Vec2",a),Object.defineProperty(a,"one",{get:function(){return new a(1,1)}}),Object.defineProperty(a,"zero",{get:function(){return new a(0,0)}}),Object.defineProperty(a,"up",{get:function(){return new a(0,1)}}),Object.defineProperty(a,"right",{get:function(){return new a(1,0)}}),a.prototype.clone=function(){return new a(this.x,this.y)},a.prototype.set=function(a){return this.x=a.x,this.y=a.y,this},a.prototype.equals=function(b){return b&&b instanceof a?this.x===b.x&&this.y===b.y:!1},a.prototype.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},a.prototype.addSelf=function(a){return this.x+=a.x,this.y+=a.y,this},a.prototype.add=function(b,c){return c=c||new a,c.x=this.x+b.x,c.y=this.y+b.y,c},a.prototype.subSelf=function(a){return this.x-=a.x,this.y-=a.y,this},a.prototype.sub=function(b,c){return c=c||new a,c.x=this.x-b.x,c.y=this.y-b.y,c},a.prototype.mulSelf=function(a){return this.x*=a,this.y*=a,this},a.prototype.mul=function(b,c){return c=c||new a,c.x=this.x*b,c.y=this.y*b,c},a.prototype.scaleSelf=function(a){return this.x*=a.x,this.y*=a.y,this},a.prototype.scale=function(b,c){return c=c||new a,c.x=this.x*b.x,c.y=this.y*b.y,c},a.prototype.divSelf=function(a){return this.x/=a.x,this.y/=a.y,this},a.prototype.div=function(b,c){return c=c||new a,c.x=this.x/b.x,c.y=this.y/b.y,c},a.prototype.negSelf=function(){return this.x=-this.x,this.y=-this.y,this},a.prototype.neg=function(b){return b=b||new a,b.x=-this.x,b.y=-this.y,b},a.prototype.dot=function(a){return this.x*a.x+this.y*a.y},a.prototype.cross=function(a){return this.y*a.x-this.x*a.y},a.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.magSqr=function(){return this.x*this.x+this.y*this.y},a.prototype.normalizeSelf=function(){var a=this.x*this.x+this.y*this.y;if(1===a)return this;if(0===a)return console.warn("Can't normalize zero vector"),this;var b=1/Math.sqrt(a);return this.x*=b,this.y*=b,this},a.prototype.normalize=function(b){return b=b||new a,b.x=this.x,b.y=this.y,b.normalizeSelf(),b},a.prototype.angle=function(a){var b=this.magSqr(),c=a.magSqr();if(0===b||0===c)return console.warn("Can't get angle between zero vector"),0;var d=this.dot(a),e=d/Math.sqrt(b*c);return e=Math.clamp(e,-1,1),Math.acos(e)},a.prototype.signAngle=function(a){return Math.atan2(this.y,this.x)-Math.atan2(a.y,a.x)},a.prototype.rotate=function(b,c){return c=c||new a,c.x=this.x,c.y=this.y,c.rotateSelf(b)},a.prototype.rotateSelf=function(a){var b=Math.sin(a),c=Math.cos(a),d=this.x;return this.x=c*d-b*this.y,this.y=b*d+c*this.y,this},a}(),Fire.Vec2=Vec2,Fire.v2=function(a,b){return Array.isArray(a)?new Vec2(a[0],a[1]):new Vec2(a,b)};var Matrix23=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0};JS.setClassName("Fire.Matrix23",Matrix23),Fire.Matrix23=Matrix23,Matrix23.identity=new Matrix23,Matrix23.prototype.clone=function(){var a=new Matrix23;return a.a=this.a,a.b=this.b,a.c=this.c,a.d=this.d,a.tx=this.tx,a.ty=this.ty,a},Matrix23.prototype.set=function(a){return this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.tx=a.tx,this.ty=a.ty,this},Matrix23.prototype.equals=function(a){return this.a===a.a&&this.b===a.b&&this.c===a.c&&this.d===a.d&&this.tx===a.tx&&this.ty===a.ty},Matrix23.prototype.toString=function(){return"|"+this.a.toFixed(2)+" "+this.c.toFixed(2)+" "+this.tx.toFixed(2)+"|\n|"+this.b.toFixed(2)+" "+this.d.toFixed(2)+" "+this.ty.toFixed(2)+"|\n|0.00 0.00 1.00|"},Matrix23.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Matrix23.prototype.prepend=function(a){var b=a.a,c=a.b,d=a.c,e=a.d;if(1!==b||0!==c||0!==d||1!==e){var f=this.a,g=this.c;this.a=f*b+this.b*d,this.b=f*c+this.b*e,this.c=g*b+this.d*d,this.d=g*c+this.d*e;var h=this.tx;this.tx=h*b+this.ty*d+a.tx,this.ty=h*c+this.ty*e+a.ty}else this.tx+=a.tx,this.ty+=a.ty;return this},Matrix23.prototype.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=1/(a*d-b*c);return this.a=d*f,this.b=-b*f,this.c=-c*f,this.d=a*f,this.tx=(c*this.ty-d*e)*f,this.ty=(b*e-a*this.ty)*f,this},Matrix23.prototype.transformPoint=function(a,b){b=b||new Vec2;var c=a.x;return b.x=this.a*c+this.c*a.y+this.tx,b.y=this.b*c+this.d*a.y+this.ty,b},Matrix23.prototype.getScale=function(a){return a=a||new Vec2,a.x=Math.sqrt(this.a*this.a+this.b*this.b),a.y=Math.sqrt(this.c*this.c+this.d*this.d),a},Matrix23.prototype.setScale=function(a){var b=this.getScale(),c=a.x/b.x,d=a.y/b.y;return this.a*=c,this.b*=c,this.c*=d,this.d*=d,this},Matrix23.prototype.getRotation=function(){var a=this.b/this.a!==-this.c/this.d;return a?.5*(Math.atan2(this.b,this.a)+Math.atan2(-this.c,this.d)):Math.atan2(-this.c,this.d)},Matrix23.prototype.getTranslation=function(a){return a=a||new Vec2,a.x=this.tx,a.y=this.ty,a},Matrix23.prototype.rotate=function(a){var b=Math.sin(a),c=Math.cos(a),d=this.a,e=this.b;return this.a=d*c+this.c*b,this.b=e*c+this.d*b,this.c=this.c*c-d*b,this.d=this.d*c-e*b,this};var Rect=function(){function a(a,b,c,d){this.x="number"==typeof a?a:0,this.y="number"==typeof b?b:0,this.width="number"==typeof c?c:0,this.height="number"==typeof d?d:0}return JS.setClassName("Fire.Rect",a),a.fromMinMax=function(b,c){var d=Math.min(b.x,c.x),e=Math.min(b.y,c.y),f=Math.max(b.x,c.x),g=Math.max(b.y,c.y);return new a(d,e,f-d,g-e)},a.fromVec2=function(b,c){return new a(b.x,b.y,c.x,c.y)},a.contain=function(a,b){return a.x<=b.x&&a.x+a.width>=b.x+b.width&&a.y<=b.y&&a.y+a.height>=b.y+b.height?1:b.x<=a.x&&b.x+b.width>=a.x+a.width&&b.y<=a.y&&b.y+b.height>=a.y+a.height?-1:0},a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)},a.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height},a.prototype.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},Object.defineProperty(a.prototype,"xMin",{get:function(){return this.x},set:function(a){this.width+=this.x-a,this.x=a}}),Object.defineProperty(a.prototype,"yMin",{get:function(){return this.y},set:function(a){this.height+=this.y-a,this.y=a}}),Object.defineProperty(a.prototype,"xMax",{get:function(){return this.x+this.width},set:function(a){this.width=a-this.x}}),Object.defineProperty(a.prototype,"yMax",{get:function(){return this.y+this.height},set:function(a){this.height=a-this.y}}),Object.defineProperty(a.prototype,"center",{get:function(){return new Fire.Vec2(this.x+.5*this.width,this.y+.5*this.height)},set:function(a){this.x=a.x-.5*this.width,this.y=a.y-.5*this.height}}),a.prototype.intersects=function(a){return Fire.Intersection.rectRect(this,a)},a.prototype.contains=function(a){return this.x<=a.x&&this.x+this.width>=a.x&&this.y<=a.y&&this.y+this.height>=a.y?!0:!1},a.prototype.containsRect=function(a){return this.x<=a.x&&this.x+this.width>=a.x+a.width&&this.y<=a.y&&this.y+this.height>=a.y+a.height?!0:!1},a}();Fire.Rect=Rect,Fire.rect=function(a,b,c,d){return Array.isArray(a)?new Rect(a[0],a[1],a[2],a[3]):new Rect(a,b,c,d)},Fire.Polygon=function(){function a(a){this.points=a,this.points.length<3&&console.warn("Invalid polygon, the data must contains 3 or more points.")}return JS.setClassName("Fire.Polygon",a),a.prototype.intersects=function(a){return Intersection.polygonPolygon(this,a)},a.prototype.contains=function(a){for(var b=!1,c=a.x,d=a.y,e=this.points.length,f=0,g=e-1;e>f;g=f++){var h=this.points[f].x,i=this.points[f].y,j=this.points[g].x,k=this.points[g].y,l=i>d!=k>d&&(j-h)*(d-i)/(k-i)+h>c;l&&(b=!b)}return b},Object.defineProperty(a.prototype,"center",{get:function(){if(this.points.length<3)return null;for(var a=this.points[0].x,b=this.points[0].y,c=this.points[0].x,d=this.points[0].y,e=1;e<this.points.length;++e){var f=this.points[e].x,g=this.points[e].y;a>f?a=f:f>c&&(c=f),b>g?b=g:g>d&&(d=g)}return new Fire.Vec2(.5*(c+a),.5*(d+b))}}),a}();var Color=function(){function a(a,b,c,d){this.r="number"==typeof a?a:0,this.g="number"==typeof b?b:0,this.b="number"==typeof c?c:0,this.a="number"==typeof d?d:1}JS.setClassName("Fire.Color",a);var b={white:[1,1,1,1],black:[0,0,0,1],transparent:[0,0,0,0],gray:[.5,.5,.5],red:[1,0,0],green:[0,1,0],blue:[0,0,1],yellow:[1,235/255,4/255],cyan:[0,1,1],magenta:[1,0,1]};for(var c in b){var d=function(b,c,d,e){return function(){return new a(b,c,d,e)
}}.apply(null,b[c]);Object.defineProperty(a,c,{get:d})}return a.prototype.clone=function(){return new a(this.r,this.g,this.b,this.a)},a.prototype.equals=function(a){return this.r===a.r&&this.g===a.g&&this.b===a.b&&this.a===a.a},a.prototype.toString=function(){return"rgba("+this.r.toFixed(2)+", "+this.g.toFixed(2)+", "+this.b.toFixed(2)+", "+this.a.toFixed(2)+")"},a.prototype.toCSS=function(a){return"rgba"===a?"rgba("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+","+this.a.toFixed(2)+")":"rgb"===a?"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")":"#"+this.toHEX(a)},a.prototype.clamp=function(){this.r=Math.clamp01(this.r),this.g=Math.clamp01(this.g),this.b=Math.clamp01(this.b),this.a=Math.clamp01(this.a)},a.prototype.fromHEX=function(a){var b=parseInt(a.indexOf("#")>-1?a.substring(1):a,16);return this.r=b>>16,this.g=(65280&b)>>8,this.b=255&b,this},a.prototype.toHEX=function(a){var b=[(255*this.r|0).toString(16),(255*this.g|0).toString(16),(255*this.b|0).toString(16)],c=-1;if("#rgb"===a)for(c=0;c<b.length;++c)b[c].length>1&&(b[c]=b[c][0]);else if("#rrggbb"===a)for(c=0;c<b.length;++c)1===b[c].length&&(b[c]="0"+b[c]);return b.join("")},a.prototype.toRGBValue=function(){return(255*Math.clamp01(this.r)<<16)+(255*Math.clamp01(this.g)<<8)+255*Math.clamp01(this.b)},a.prototype.fromHSV=function(a,b,c){var d=Fire.hsv2rgb(a,b,c);return this.r=d.r,this.g=d.g,this.b=d.b,this},a.prototype.toHSV=function(){return Fire.rgb2hsv(this.r,this.g,this.b)},a}();Fire.Color=Color,Fire.color=function(a,b,c,d){return Array.isArray(a)?new Color(a[0],a[1],a[2],a[3]):new Color(a,b,c,d)},Fire.TextAlign=Fire.defineEnum({left:-1,center:-1,right:-1}),Fire.TextAnchor=function(a){return a[a.topLeft=0]="Top Left",a[a.topCenter=1]="Top Center",a[a.topRight=2]="Top Right",a[a.midLeft=3]="Middle Left",a[a.midCenter=4]="Middle Center",a[a.midRight=5]="Middle Right",a[a.botLeft=6]="Bottom Left",a[a.botCenter=7]="Bottom Center",a[a.botRight=8]="Bottom Right",a}({});var _Deserializer=function(){function a(a,b,c,d,e){if(this._editor=d,this._classFinder=e,this._idList=[],this._idObjList=[],this._idPropList=[],this.result=b||new Fire._DeserializeInfo,Array.isArray(a)){var h=a,i=h.length;this.deserializedList=new Array(i);for(var j=0;i>j;j++)if(h[j]){var k;this.deserializedList[j]=g(this,h[j],k)}this.deserializedData=i>0?this.deserializedList[0]:[]}else this.deserializedList=[null],this.deserializedData=a?g(this,a,c):null,this.deserializedList[0]=this.deserializedData;f(this)}function b(a,b,c,d){var e=c.__id__;if("undefined"==typeof e){var f=c.__uuid__;f?(a.result.uuidList.push(f),a.result.uuidObjList.push(b),a.result.uuidPropList.push(d)):b[d]=g(a,c)}else{var h=a.deserializedList[e];h?b[d]=h:(a._idList.push(e),a._idObjList.push(b),a._idPropList.push(d))}}function c(a,c,d){for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];"object"!=typeof f?"__type__"!==e&&(c[e]=f):f?f.__uuid__||"undefined"!=typeof f.__id__?b(a,c,f,e):c[e]=g(a,f):c[e]=null}}function d(a,c,d){for(var e in c){var f=d[e];"undefined"!=typeof f&&d.hasOwnProperty(e)&&("object"!=typeof f?c[e]=f:f?f.__uuid__||"undefined"!=typeof f.__id__?b(a,c,f,e):c[e]=g(a,f):c[e]=null)}}function e(a,d,e,f){var h=f.__props__;if(h){for(var i=0;i<h.length;i++){var j=h[i],k=Fire.attr(f,j),l=k.rawType;if(l)a.result.rawProp&&Fire.error("not support multi raw object in a file"),a.result.rawProp=j;else{if(k.serializable===!1)continue;if(!a._editor&&k.editorOnly)continue;var m=e[j];"undefined"!=typeof m&&("object"!=typeof m?d[j]=m:m?m.__uuid__||"undefined"!=typeof m.__id__?b(a,d,m,j):d[j]=g(a,m):d[j]=null)}}"_$erialized"===h[h.length-1]&&(d._$erialized=e,c(a,d._$erialized,e))}}var f=function(a){for(var b=a.deserializedList,c=0,d=a._idList.length;d>c;c++){var e=a._idPropList[c],f=a._idList[c];a._idObjList[c][e]=b[f]}},g=function(a,f,h){var i,j=null,k=null;if(f.__type__){if(k=a._classFinder(f.__type__),!k)return Fire.error("[Fire.deserialize] unknown type: "+f.__type__),null;j=new k,Fire._isFireClass(k)?e(a,j,f,k,h):d(a,j,f)}else if(Array.isArray(f)){j=new Array(f.length);for(var l=0;l<f.length;l++)i=f[l],"object"==typeof i&&i?i.__uuid__||"undefined"!=typeof i.__id__?b(a,j,i,""+l):j[l]=g(a,i):j[l]=i}else j={},c(a,j,f);return j};return a}();Fire.deserialize=function(a,b,c){var d,e=c&&"isEditor"in c?c.isEditor:Fire.isEditor,f=c&&c.classFinder||JS._getClassById,g=c&&c.createAssetRefs||Fire.isEditorCore;"string"==typeof a&&(a=JSON.parse(a)),g&&!b&&(b=new Fire._DeserializeInfo),Fire._isCloning=!0;var h=new _Deserializer(a,b,d,e,f);return Fire._isCloning=!1,g&&b.assignAssetsBy(Editor.serialize.asAsset),h.deserializedData},Fire._DeserializeInfo=function(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.rawProp=""},Fire._DeserializeInfo.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.rawProp=""},Fire._DeserializeInfo.prototype.getUuidOf=function(a,b){for(var c=0;c<this.uuidObjList.length;c++)if(this.uuidObjList[c]===a&&this.uuidPropList[c]===b)return this.uuidList[c];return""},Fire._DeserializeInfo.prototype.assignAssetsBy=function(a){for(var b=!0,c=0,d=this.uuidList.length;d>c;c++){var e=this.uuidList[c],f=a(e);if(f){var g=this.uuidObjList[c],h=this.uuidPropList[c];g[h]=f}else Fire.error("Failed to assign asset: "+e),b=!1}return b},Fire.instantiate=function(a){if("object"!=typeof a||Array.isArray(a))return Fire.error("The thing you want to instantiate must be an object"),null;if(!a)return Fire.error("The thing you want to instantiate is nil"),null;if(a instanceof Fire.FObject&&!a.isValid)return Fire.error("The thing you want to instantiate is destroyed"),null;var b;return a._instantiate?(Fire._isCloning=!0,b=a._instantiate(),Fire._isCloning=!1,b):a instanceof Fire.Asset?(Fire.error("The instantiate method for given asset do not implemented"),null):(Fire._isCloning=!0,b=Fire._doInstantiate(a),Fire._isCloning=!1,b)},Fire._doInstantiate=function(){function a(a){if(Array.isArray(a))return Fire.error("Can not instantiate array"),null;if(_isDomNode(a))return Fire.error("Can not instantiate DOM element"),null;for(var b=d(a),e=0,f=c.length;f>e;++e)c[e]._iN$t=null;return c.length=0,b}function b(a){var e=a._iN$t;if(e)return e;if(a instanceof Asset)return a;if(Array.isArray(a)){var f=a.length;e=new Array(f),a._iN$t=e;for(var g=0;f>g;++g){var h=a[g],i=typeof h;e[g]="object"===i?h?b(h):h:"function"!==i?h:null}return c.push(a),e}return _isDomNode(a)?null:d(a)}var c=[],d=function(a){var d,e,f=a.constructor,g=new f;if(a._iN$t=g,c.push(a),Fire._isFireClass(f)){var h=f.__props__;if(h)for(var i=0;i<h.length;i++){var j=h[i],k=Fire.attr(f,j);k.serializable!==!1&&(d=a[j],e=typeof d,g[j]="object"===e?d?b(d):d:"function"!==e?d:null)}}else for(var l in a)a.hasOwnProperty(l)===!1||95===l.charCodeAt(0)&&95===l.charCodeAt(1)||(d=a[l],d!==g&&(e=typeof d,g[l]="object"===e?d?b(d):d:"function"!==e?d:null));return a instanceof FObject&&(g._objFlags&=PersistentMask),g};return a}(),Fire._isCloning=!1;var Asset=Fire.Class({name:"Fire.Asset","extends":Fire.HashObject,constructor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0,enumerable:!1}),this.dirty=!1},_setRawExtname:function(a){this.hasOwnProperty("_rawext")?("."===a.charAt(0)&&(a=a.substring(1)),this._rawext=a):Fire.error("Have not defined any RawTypes yet, no need to set raw file's extname.")}});Fire.Asset=Asset;var CustomAsset=function(){var a=Fire.extend("Fire.CustomAsset",Fire.Asset);return a}();Fire.CustomAsset=CustomAsset,Fire.addCustomAssetMenu=Fire.addCustomAssetMenu||function(){},Fire.ScriptAsset=function(){var a=Fire.extend("Fire.ScriptAsset",Fire.Asset);return a.prop("text","",Fire.MultiText,Fire.RawType("text"),Fire.HideInInspector),a}(),Fire.Texture=function(){var a=Fire.extend("Fire.Texture",Fire.Asset,function(){var a=arguments[0];a&&(this.image=a,this.width=a.width,this.height=a.height)});return a.WrapMode=Fire.defineEnum({Repeat:-1,Clamp:-1}),a.FilterMode=Fire.defineEnum({Point:-1,Bilinear:-1,Trilinear:-1}),a.prop("image",null,Fire.RawType("image"),Fire.HideInInspector),a.prop("width",0,Fire.Integer_Obsoleted,Fire.ReadOnly),a.prop("height",0,Fire.Integer_Obsoleted,Fire.ReadOnly),a.prop("wrapMode",a.WrapMode.Clamp,Fire.Enum(a.WrapMode),Fire.ReadOnly),a.prop("filterMode",a.FilterMode.Bilinear,Fire.Enum(a.FilterMode),Fire.ReadOnly),a}(),Fire.Sprite=function(){var a=Fire.extend("Fire.Sprite",Fire.Asset,function(){var a=arguments[0];a&&(this.texture=new Fire.Texture(a),this.width=a.width,this.height=a.height)});return a.prop("pivot",new Fire.Vec2(.5,.5),Fire.Tooltip("The pivot is normalized, like a percentage.\n(0,0) means the bottom-left corner and (1,1) means the top-right corner.\nBut you can use values higher than (1,1) and lower than (0,0) too.")),a.prop("trimX",0,Fire.Integer_Obsoleted),a.prop("trimY",0,Fire.Integer_Obsoleted),a.prop("width",0,Fire.Integer_Obsoleted),a.prop("height",0,Fire.Integer_Obsoleted),a.prop("texture",null,Fire.ObjectType(Fire.Texture),Fire.HideInInspector),a.prop("rotated",!1,Fire.HideInInspector),a.prop("x",0,Fire.Integer_Obsoleted,Fire.HideInInspector),a.prop("y",0,Fire.Integer_Obsoleted,Fire.HideInInspector),a.prop("rawWidth",0,Fire.Integer_Obsoleted,Fire.HideInInspector),a.prop("rawHeight",0,Fire.Integer_Obsoleted,Fire.HideInInspector),Object.defineProperty(a.prototype,"rotatedWidth",{get:function(){return this.rotated?this.height:this.width}}),Object.defineProperty(a.prototype,"rotatedHeight",{get:function(){return this.rotated?this.width:this.height}}),a}(),Fire.Atlas=function(){var a=Fire.extend("Fire.Atlas",Fire.Asset);return a.Algorithm=Fire.defineEnum({Basic:-1,Tree:-1,MaxRect:-1}),a.SortBy=Fire.defineEnum({UseBest:-1,Width:-1,Height:-1,Area:-1,Name:-1}),a.SortOrder=Fire.defineEnum({UseBest:-1,Ascending:-1,Descending:-1}),a.prop("width",512,Fire.Integer_Obsoleted,Fire.ReadOnly),a.prop("height",512,Fire.Integer_Obsoleted,Fire.ReadOnly),a.prop("sprites",[],Fire.ObjectType(Fire.Sprite),Fire.HideInInspector),a.prototype.add=function(a){for(var b=0;b<this.sprites.length;++b){var c=this.sprites[b];if(c._uuid===a._uuid)return!1}return this.sprites.push(a),!0},a.prototype.remove=function(a){for(var b=0;b<this.sprites.length;++b){var c=this.sprites[b];if(c._uuid===a._uuid)return this.sprites.splice(b,1),!0}return!1},a.prototype.clear=function(){this.sprites=[]},a.prototype.layout=function(a){void 0===a.algorithm&&(a.algorithm=Fire.Atlas.Algorithm.MaxRect),void 0===a.sortBy&&(a.sortBy=Fire.Atlas.SortBy.UseBest),void 0===a.sortOrder&&(a.sortOrder=Fire.Atlas.SortOrder.UseBest),void 0===a.allowRotate&&(a.allowRotate=!0),void 0===a.autoSize&&(a.autoSize=!0),void 0===a.padding&&(a.padding=2),Editor.AtlasUtils.sort(this,a.algorithm,a.sortBy,a.sortOrder,a.allowRotate),Editor.AtlasUtils.layout(this,a.algorithm,a.autoSize,a.padding,a.allowRotate)},a}();var AtlasUtils={},_basicLayout=function(a,b){for(var c=0,d=0,e=0,f=0;f<a.sprites.length;++f){var g=a.sprites[f];if(c+g.rotatedWidth>a.width&&(c=0,d=d+e+b,e=0),d+g.rotatedHeight>a.height)throw new Error("Warning: Failed to layout element "+g.name);g.x=c,g.y=d,c=c+g.rotatedWidth+b,g.rotatedHeight>e&&(e=g.rotatedHeight)}},_insertNode=function(a,b,c,d){if(null!==a.right){var e=_insertNode(a.right,b,c,d);return null!==e?e:_insertNode(a.bottom,b,c,d)}var f=b.rotatedWidth,g=b.rotatedHeight,h=f+c,i=g+c,j=a.rect;if(f>j.width||g>j.height){if(d===!1)return null;if(g>j.width||f>j.height)return null;b.rotated=!b.rotated,f=b.rotatedWidth,g=b.rotatedHeight,h=f+c,i=g+c}return a.right={rect:new Fire.Rect(j.x+h,j.y,j.width-h,g),right:null,bottom:null},a.bottom={rect:new Fire.Rect(j.x,j.y+i,j.width,j.height-i),right:null,bottom:null},[j.x,j.y]},_treeLayout=function(a,b,c){for(var d={rect:new Fire.Rect(0,0,a.width,a.height),right:null,bottom:null},e=0;e<a.sprites.length;++e){var f=a.sprites[e],g=_insertNode(d,f,b,c);if(null===g)throw new Error("Warning: Failed to layout element "+f.name);f.x=g[0],f.y=g[1]}},_splitFreeNode=function(a,b,c){if(c.x>=b.x+b.width||c.x+c.width<=b.x||c.y>=b.y+b.height||c.y+c.height<=b.y)return!1;var d;return c.x<b.x+b.width&&c.x+c.width>b.x&&(c.y>b.y&&c.y<b.y+b.height&&(d=b.clone(),d.height=c.y-d.y,a.push(d)),c.y+c.height<b.y+b.height&&(d=b.clone(),d.y=c.y+c.height,d.height=b.y+b.height-(c.y+c.height),a.push(d))),c.y<b.y+b.height&&c.y+c.height>b.y&&(c.x>b.x&&c.x<b.x+b.width&&(d=b.clone(),d.width=c.x-d.x,a.push(d)),c.x+c.width<b.x+b.width&&(d=b.clone(),d.x=c.x+c.width,d.width=b.x+b.width-(c.x+c.width),a.push(d))),!0},_placeRect=function(a,b){var c;for(c=0;c<a.length;++c)_splitFreeNode(a,a[c],b)&&(a.splice(c,1),--c);for(c=0;c<a.length;++c)for(var d=c+1;d<a.length;++d){if(a[d].containsRect(a[c])){a.splice(c,1),--c;break}a[c].containsRect(a[d])&&(a.splice(d,1),--d)}},_maxRectLayout=function(a,b,c){var d=[];d.push(new Fire.Rect(0,0,a.width+b,a.height+b));for(var e,f=function(a,b,c,d){e=Number.MAX_VALUE,score2=Number.MAX_VALUE;for(var f=new Fire.Rect(0,0,1,1),g=!1,h=0;h<a.length;++h){var i,j,k,l,m=a[h];m.width>=b&&m.height>=c&&(i=Math.abs(Math.floor(m.width)-b),j=Math.abs(Math.floor(m.height)-c),k=Math.min(i,j),l=Math.max(i,j),(e>k||k===e&&l<score2)&&(f.x=m.x,f.y=m.y,f.width=b,f.height=c,e=k,score2=l,g=!0)),d&&m.width>=c&&m.height>=b&&(i=Math.abs(Math.floor(m.width)-c),j=Math.abs(Math.floor(m.height)-b),k=Math.min(i,j),l=Math.max(i,j),(e>k||k===e&&l<score2)&&(f.x=m.x,f.y=m.y,f.width=c,f.height=b,e=k,score2=l,g=!0))}return g===!1&&(e=Number.MAX_VALUE,score2=Number.MAX_VALUE),f},g=a.sprites.slice();g.length>0;){for(var h=Number.MAX_VALUE,i=Number.MAX_VALUE,j=-1,k=new Fire.Rect(0,0,1,1),l=0;l<g.length;++l){var m=f(d,g[l].width+b,g[l].height+b,c);(h>e||e===h&&score2<i)&&(h=e,i=score2,k=m,j=l)}if(-1===j)throw new Error("Error: Failed to layout atlas element");_placeRect(d,k);var n=g[j];n.x=Math.floor(k.x),n.y=Math.floor(k.y),n.rotated=n.width+b!==k.width,g.splice(j,1)}};AtlasUtils.layout=function(a,b,c,d,e){try{switch(b){case Fire.Atlas.Algorithm.Basic:_basicLayout(a,d);break;case Fire.Atlas.Algorithm.Tree:_treeLayout(a,d,e);break;case Fire.Atlas.Algorithm.MaxRect:_maxRectLayout(a,d,e)}}catch(f){if(c===!1)return void Fire.error(f.message);if(4096===a.width&&4096===a.height)return void Fire.error(f.message);a.width===a.height?a.width*=2:a.height=a.width,AtlasUtils.layout(a,b,c,d,e)}};var _compareByWidth=function(a,b){var c=a.width-b.width;return 0===c&&(c=a.name.localeCompare(b.name)),c},_compareByHeight=function(a,b){var c=a.height-b.height;return 0===c&&(c=a.name.localeCompare(b.name)),c},_compareByArea=function(a,b){var c=a.width*a.height-b.width*b.height;return 0===c&&(c=a.name.localeCompare(b.name)),c},_compareByName=function(a,b){return a.name.localeCompare(b.name)},_compareByRotateWidth=function(a,b){var c=a.width;a.height>a.width&&(c=a.height,a.rotated=!0);var d=b.width;b.height>b.width&&(d=b.height,b.rotated=!0);var e=c-d;return 0===e&&(e=a.name.localeCompare(b.name)),e},_compareByRotateHeight=function(a,b){var c=a.height;a.width>a.height&&(c=a.width,a.rotated=!0);var d=b.height;b.width>b.height&&(d=b.width,b.rotated=!0);var e=c-d;return 0===e&&(e=a.name.localeCompare(b.name)),e};AtlasUtils.sort=function(a,b,c,d,e){for(var f=0;f<a.sprites.length;++f){var g=a.sprites[f];g.rotated=!1}var h=c,i=d;if(h===Fire.Atlas.SortBy.UseBest)switch(b){case Fire.Atlas.Algorithm.Basic:h=Fire.Atlas.SortBy.Height;break;case Fire.Atlas.Algorithm.Tree:h=Fire.Atlas.SortBy.Area;break;case Fire.Atlas.Algorithm.MaxRect:h=Fire.Atlas.SortBy.Area;break;default:h=Fire.Atlas.SortBy.Height}switch(i===Fire.Atlas.SortOrder.UseBest&&(i=Fire.Atlas.SortOrder.Descending),h){case Fire.Atlas.SortBy.Width:a.sprites.sort(e?_compareByRotateWidth:_compareByWidth);break;case Fire.Atlas.SortBy.Height:a.sprites.sort(e?_compareByRotateHeight:_compareByHeight);break;case Fire.Atlas.SortBy.Area:a.sprites.sort(_compareByArea);break;case Fire.Atlas.SortBy.Name:a.sprites.sort(_compareByName)}i===Fire.Atlas.SortOrder.Descending&&a.sprites.reverse()},Editor.AtlasUtils=AtlasUtils;var JsonAsset=function(){var a=Fire.extend("Fire.JsonAsset",Asset).prop("json",null,Fire.RawType("json"));return a}();Fire.JsonAsset=JsonAsset,Fire.TextAsset=function(){var a=Fire.extend("Fire.TextAsset",Fire.Asset);return a.prop("text","",Fire.MultiText,Fire.RawType("text")),a}();var BitmapFont=function(){var a=Fire.extend("Fire.BitmapFont",Fire.Asset);return a.prop("texture",null,Fire.ObjectType(Fire.Texture),Fire.HideInInspector),a.prop("charInfos",[],Fire.HideInInspector),a.prop("kernings",[],Fire.HideInInspector),a.prop("baseLine",0,Fire.Integer_Obsoleted,Fire.ReadOnly),a.prop("lineHeight",0,Fire.Integer_Obsoleted,Fire.ReadOnly),a.prop("size",0,Fire.Integer_Obsoleted,Fire.ReadOnly),a.prop("face",null,Fire.HideInInspector),a}();Fire.BitmapFont=BitmapFont,Fire.AudioClip=function(){var a=Fire.Class({name:"Fire.AudioClip","extends":Fire.Asset,properties:{rawData:{"default":null,rawType:"audio",visible:!1},buffer:{get:function(){return Fire.AudioContext.getClipBuffer(this)},visible:!1},length:{get:function(){return Fire.AudioContext.getClipLength(this)}},samples:{get:function(){return Fire.AudioContext.getClipSamples(this)}},channels:{get:function(){return Fire.AudioContext.getClipChannels(this)}},frequency:{get:function(){return Fire.AudioContext.getClipFrequency(this)}}}});return a}(),Fire._throw=function(a){Fire.error(a.stack)};var AssetsWatcher={initComponent:function(){},start:function(){},stop:function(){}};Editor._AssetsWatcher=AssetsWatcher;var editorCallback={onEnginePlayed:null,onEngineStopped:null,onEnginePaused:null,onEntityCreated:null,onEntityRemoved:null,onEntityParentChanged:null,onEntityIndexChanged:null,onEntityRenamed:null,onStartUnloadScene:null,onSceneLaunched:null,onComponentEnabled:null,onComponentDisabled:null,onComponentAdded:null,onComponentRemoved:null},ImageLoader,JsonLoader,TextLoader,_LoadFromXHR,ModifierKeyStates,KeyboardEvent,MouseEvent,Destroying=Fire._ObjectFlags.Destroying,DontDestroy=Fire._ObjectFlags.DontDestroy,Hide=Fire._ObjectFlags.Hide,HideInGame=Fire._ObjectFlags.HideInGame,HideInEditor=Fire._ObjectFlags.HideInEditor,ContentStrategyType=Fire.defineEnum({NoScale:-1,FixedHeight:-1});Fire.ContentStrategyType=ContentStrategyType,Fire._Runtime={},JS.getset(Fire._Runtime,"RenderContext",function(){return RenderContext},function(a){RenderContext=a});var Time=function(){var a={};a.time=0,a.realTime=0,a.deltaTime=0,a.frameCount=0,a.maxDeltaTime=.3333333;var b=0,c=0;return a._update=function(d,e){if(!e){var f=d-b;f=Math.min(a.maxDeltaTime,f),b=d,++a.frameCount,a.deltaTime=f,a.time+=f}a.realTime=d-c},a._restart=function(d){a.time=0,a.realTime=0,a.deltaTime=0,a.frameCount=0,b=d,c=d},a}();Fire.Time=Time;var Event=function(){function a(a,b){"undefined"==typeof b&&(b=!1),this.type=a,this.target=null,this.currentTarget=null,this.eventPhase=0,this.bubbles=b,this._defaultPrevented=!1,this._propagationStopped=!1,this._propagationImmediateStopped=!1}return a.NONE=0,a.CAPTURING_PHASE=1,a.AT_TARGET=2,a.BUBBLING_PHASE=3,a.prototype.stop=function(a){this._propagationStopped=!0,a&&(this._propagationImmediateStopped=!0)},a.prototype.preventDefault=function(){this._defaultPrevented=!0},a.prototype._reset=function(){this.target=null,this.currentTarget=null,this.eventPhase=0,this._defaultPrevented=!1,this._propagationStopped=!1,this._propagationImmediateStopped=!1},a}();Fire.Event=Event;var EventListeners=function(){function a(){Fire._CallbacksHandler.call(this)}return JS.extend(a,Fire._CallbacksHandler),a.prototype.invoke=function(a){var b=this._callbackTable[a.type];if(b&&b.length>0){if(1===b.length)return void b[0](a);for(var c=b.length-1,d=b[c],e=0;c>=e;++e){var f=b[e];if(f(a),a._propagationImmediateStopped||e===c)break;if(b[c]!==d){if(b[c-1]!==d)return void Fire.error("Call event.stop(true) when you remove more than one callbacks in a event callback.");b[e]!==f&&--e,--c}}}},a}(),EventTarget=function(){function a(){HashObject.call(this),this._capturingListeners=null,this._bubblingListeners=null}JS.extend(a,HashObject),a.prototype.on=function(a,b,c){if(c="undefined"!=typeof c?c:!1,!b)return void Fire.error("Callback of event must be non-nil");var d=null;d=c?this._capturingListeners=this._capturingListeners||new EventListeners:this._bubblingListeners=this._bubblingListeners||new EventListeners,d.has(a,b)||d.add(a,b)},a.prototype.off=function(a,b,c){if(c="undefined"!=typeof c?c:!1,b){var d=c?this._capturingListeners:this._bubblingListeners;d&&d.remove(a,b)}},a.prototype.once=function(a,b,c){var d=this,e=function(f){d.off(a,e,c),b(f)};this.on(a,e,c)};var b=new Array(16);return b.length=0,a.prototype._doDispatchEvent=function(a){a.target=this,this._getCapturingTargets(a.type,b),a.eventPhase=1;var c,d;for(d=b.length-1;d>=0;--d)if(c=b[d],c.isValid&&c._capturingListeners&&(a.currentTarget=c,c._capturingListeners.invoke(a),a._propagationStopped))return;if(b.length=0,(!this.isValid||(this._doSendEvent(a),!a._propagationStopped))&&a.bubbles)for(this._getBubblingTargets(a.type,b),a.eventPhase=3,d=0;d<b.length;++d)if(c=b[d],c.isValid&&c._bubblingListeners&&(a.currentTarget=c,c._bubblingListeners.invoke(a),a._propagationStopped))return},a.prototype.dispatchEvent=function(a){this._doDispatchEvent(a),b.length=0;var c=!a._defaultPrevented;return a._reset(),c},a.prototype._doSendEvent=function(a){a.eventPhase=2,a.currentTarget=this,this._capturingListeners&&(this._capturingListeners.invoke(a),a._propagationStopped)||this._bubblingListeners&&this._bubblingListeners.invoke(a)},a.prototype._getCapturingTargets=function(){},a.prototype._getBubblingTargets=function(){},a}();Fire.EventTarget=EventTarget;var Ticker=function(){var a={},b=60;return window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame,a.requestAnimationFrame=60===b&&window.requestAnimationFrame?function(a){return window.requestAnimationFrame(a)}:function(a){return window.setTimeout(a,1e3/b)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame,a.cancelAnimationFrame=window.cancelAnimationFrame?function(a){window.cancelAnimationFrame(a)}:function(a){window.clearTimeout(a)},a.now=window.performance&&window.performance.now?function(){return window.performance.now()/1e3}:function(){return Date.now()/1e3},a}();Fire._JsonLoader=JsonLoader;var Component=function(){function a(a,b){b?a._objFlags&c||(a._objFlags|=c,a.onEnable&&a.onEnable()):a._objFlags&c&&(a._objFlags&=~c,a.onDisable&&a.onDisable())}var b,c=Fire._ObjectFlags.IsOnEnableCalled,d=(Fire._ObjectFlags.IsEditorOnEnabledCalled,Fire._ObjectFlags.IsOnLoadCalled),e=Fire._ObjectFlags.IsOnStartCalled,f=Fire.extend("Fire.Component",HashObject,b);return f.prop("entity",null,Fire.HideInInspector),f.prop("_enabled",!0,Fire.HideInInspector),Object.defineProperty(f.prototype,"enabled",{get:function(){return this._enabled},set:function(b){this._enabled!=b&&(this._enabled=b,this.entity._activeInHierarchy&&a(this,b))}}),Object.defineProperty(f.prototype,"enabledInHierarchy",{get:function(){return this._enabled&&this.entity._activeInHierarchy}}),Object.defineProperty(f.prototype,"transform",{get:function(){return this.entity.transform}}),f.prototype.update=null,f.prototype.lateUpdate=null,f.prototype.onLoad=null,f.prototype.start=null,f.prototype.onEnable=null,f.prototype.onDisable=null,f.prototype.onDestroy=null,f.prototype.onPreRender=null,f.prototype.addComponent=function(a){return this.entity.addComponent(a)},f.prototype.getComponent=function(a){return this.entity.getComponent(a)},f.prototype.destroy=function(){FObject.prototype.destroy.call(this)&&this._enabled&&this.entity._activeInHierarchy&&a(this,!1)},f.prototype._onEntityActivated=function(b){this._objFlags&d||(this._objFlags|=d,this.onLoad&&this.onLoad()),this._enabled&&a(this,b)},f._invokeStarts=function(a){for(var b=a._components.length,c=0,d=null;b>c;++c)d=a._components[c],d._objFlags&e||(d._objFlags|=e,d.start&&d.start());for(var g=0,h=a._children,i=h.length;i>g;++g){var j=h[g];j._active&&f._invokeStarts(j)}},f.prototype._onPreDestroy=function(){a(this,!1),this.onDestroy&&this.onDestroy(),this.entity._removeComponent(this)},f}();Fire.Component=Component,Fire.addComponentMenu=function(){},Fire.executeInEditMode=function(){};var _requiringFrames=[];Fire._RFpush=function(a,b,c){2===arguments.length&&(c=b,b=""),_requiringFrames.push({uuid:b,script:c,module:a,exports:a.exports,comp:null})},Fire._RFpop=function(){var a=_requiringFrames.pop(),b=a.module,c=a.exports;if(c===b.exports){for(var d in c)return;b.exports=a.comp}},Fire._RFget=function(){return _requiringFrames[_requiringFrames.length-1]};var doDefine=Fire._doDefine;Fire._doDefine=function(a,b,c){if(Fire.isChildClassOf(b,Fire.Component)){var d=Fire._RFget();if(d){if(d.comp)return void Fire.error("Sorry, each script can have at most one Component.");d.uuid&&a&&Fire.warn("Sorry, specifying class name for Component in project scripts is not allowed."),a=a||d.script;var e=doDefine(a,b,c);return d.uuid&&JS._setClassId(d.uuid,e),d.comp=e,e}}return doDefine(a,b,c)};var Transform=function(){var a=Fire.extend("Fire.Transform",Component,function(){this._position=new Vec2(0,0),this._scale=new Vec2(1,1),this._worldTransform=new Matrix23,this._parent=null});Fire.executeInEditMode(a),a.prop("_position",null,Fire.HideInInspector),a.prop("_rotation",0,Fire.HideInInspector),a.prop("_scale",null,Fire.HideInInspector);var b="The %s must not be NaN";return a.getset("position",function(){return new Vec2(this._position.x,this._position.y)},function(a){var c=a.x,d=a.y;isNaN(c)||isNaN(d)?Fire.error(b,"xy of new position"):(this._position.x=c,this._position.y=d)},Fire.Tooltip("The local position in its parent's coordinate system")),Object.defineProperty(a.prototype,"x",{get:function(){return this._position.x},set:function(a){isNaN(a)?Fire.error(b,"new x"):this._position.x=a}}),Object.defineProperty(a.prototype,"y",{get:function(){return this._position.y},set:function(a){isNaN(a)?Fire.error(b,"new y"):this._position.y=a}}),Object.defineProperty(a.prototype,"worldPosition",{get:function(){var a=this.getLocalToWorldMatrix();return new Vec2(a.tx,a.ty)},set:function(a){var c=a.x,d=a.y;if(isNaN(c)||isNaN(d))Fire.error(b,"xy of new worldPosition");else if(this._parent){var e=this._parent.getWorldToLocalMatrix();this.position=e.transformPoint(a)}else this.position=a}}),Object.defineProperty(a.prototype,"worldX",{get:function(){return this.worldPosition.x},set:function(a){if(isNaN(a))Fire.error(b,"new worldX");else if(this._parent){var c=this._parent.getLocalToWorldMatrix(),d=this.getLocalMatrix().prepend(c);d.tx!==a&&(this._position.x=a,this._position.y=d.ty,c.invert().transformPoint(this._position,this._position))}else this._position.x=a}}),Object.defineProperty(a.prototype,"worldY",{get:function(){return this.worldPosition.y},set:function(a){if(isNaN(a))Fire.error(b,"new worldY");else if(this._parent){var c=this._parent.getLocalToWorldMatrix(),d=this.getLocalMatrix().prepend(c);d.ty!==a&&(this._position.x=d.tx,this._position.y=a,c.invert().transformPoint(this._position,this._position))}else this._position.y=a}}),a.getset("rotation",function(){return this._rotation},function(a){isNaN(a)?Fire.error(b,"new rotation"):this._rotation=a},Fire.Tooltip("The counterclockwise degrees of rotation relative to the parent")),Object.defineProperty(a.prototype,"worldRotation",{get:function(){return this._parent?this.rotation+this._parent.worldRotation:this.rotation},set:function(a){isNaN(a)?Fire.error(b,"new worldRotation"):this.rotation=this._parent?a-this._parent.worldRotation:a}}),a.getset("scale",function(){return new Vec2(this._scale.x,this._scale.y)},function(a){var c=a.x,d=a.y;isNaN(c)||isNaN(d)?Fire.error(b,"xy of new scale"):(this._scale.x=c,this._scale.y=d)},Fire.Tooltip("The local scale factor relative to the parent")),Object.defineProperty(a.prototype,"scaleX",{get:function(){return this._scale.x},set:function(a){isNaN(a)?Fire.error(b,"new scaleX"):this._scale.x=a}}),Object.defineProperty(a.prototype,"scaleY",{get:function(){return this._scale.y},set:function(a){isNaN(a)?Fire.error(b,"new scaleY"):this._scale.y=a}}),Object.defineProperty(a.prototype,"worldScale",{get:function(){var a=this.getLocalToWorldMatrix();return a.getScale()}}),a.prototype.onLoad=function(){this._parent=this.entity._parent&&this.entity._parent.transform},a.prototype.destroy=function(){Fire.error("Not allowed to destroy the transform. Please destroy the entity instead.")},a.prototype._updateTransform=function(a){var b=this._worldTransform;this.getLocalMatrix(b),b.prepend(a);for(var c=this.entity._children,d=0,e=c.length;e>d;d++)c[d].transform._updateTransform(b)},a.prototype._updateRootTransform=function(){var a=this._worldTransform;this.getLocalMatrix(a);for(var b=this.entity._children,c=0,d=b.length;d>c;c++)b[c].transform._updateTransform(a)},a.prototype.getLocalMatrix=function(a){a=a||new Matrix23;var b=.017453292519943295*this._rotation,c=0===this._rotation?0:Math.sin(b),d=0===this._rotation?1:Math.cos(b);return a.a=this._scale.x*d,a.b=this._scale.x*c,a.c=this._scale.y*-c,a.d=this._scale.y*d,a.tx=this._position.x,a.ty=this._position.y,a},a.prototype.getLocalToWorldMatrix=function(a){a=a||new Matrix23,this.getLocalMatrix(a);for(var b=new Fire.Matrix23,c=this._parent;null!==c;c=c._parent)a.prepend(c.getLocalMatrix(b));return a},a.prototype.getWorldToLocalMatrix=function(a){return this.getLocalToWorldMatrix(a).invert()},a.prototype.rotateAround=function(a,b){var c=this.worldPosition.subSelf(a);c.rotateSelf(Math.deg2rad(b)),this.worldPosition=a.addSelf(c),this.rotation=this._rotation+b},a.prototype.translate=function(a){var b=a.rotate(Math.deg2rad(this._rotation));this.position=this._position.add(b,b)},Object.defineProperty(a.prototype,"up",{get:function(){return new Vec2(0,1).rotateSelf(Math.deg2rad(this.worldRotation))},set:function(a){if(0===a.x&&0===a.y)return void Fire.warn("Can't get rotation from zero vector");var b=Math.atan2(a.y,a.x)-Math.HALF_PI;this.worldRotation=Math.rad2deg(b)}}),Object.defineProperty(a.prototype,"right",{get:function(){return new Vec2(1,0).rotateSelf(Math.deg2rad(this.worldRotation))},set:function(a){if(0===a.x&&0===a.y)return void Fire.warn("Can't get rotation from zero vector");var b=Math.atan2(a.y,a.x);this.worldRotation=Math.rad2deg(b)}}),a}();Fire.Transform=Transform;var Renderer=function(){function a(a,b,d,e,f){var g=this.getWorldSize(),h=g.x,i=g.y;this.getSelfMatrix(c),a=c.prepend(a);var j=a.tx,k=a.ty,l=a.a*h,m=a.b*h,n=a.c*-i,o=a.d*-i;d.x=j,d.y=k,e.x=l+j,e.y=m+k,b.x=n+j,b.y=o+k,f.x=l+n+j,f.y=m+o+k}var b=Fire.extend("Fire.Renderer",Component),c=new Fire.Matrix23;return b.prototype.getWorldBounds=function(b){var c=this.entity.transform.getLocalToWorldMatrix(),d=new Vec2(0,0),e=new Vec2(0,0),f=new Vec2(0,0),g=new Vec2(0,0);return a.call(this,c,d,e,f,g),b=b||new Rect,Math.calculateMaxRect(b,d,e,f,g),b},b.prototype.getWorldOrientedBounds=function(b,c,d,e){b=b||new Vec2(0,0),c=c||new Vec2(0,0),d=d||new Vec2(0,0),e=e||new Vec2(0,0);var f=this.entity.transform.getLocalToWorldMatrix();return a.call(this,f,b,c,d,e),[b,c,d,e]},b.prototype.getSelfMatrix=function(){},b.prototype.getWorldSize=function(){return new Vec2(0,0)},b}();Fire.Renderer=Renderer;var SpriteRenderer=function(){var a=Fire.extend("Fire.SpriteRenderer",Renderer,function(){RenderContext.initRenderer(this),this._hasRenderObj=!1});Fire.addComponentMenu(a,"SpriteRenderer"),Fire.executeInEditMode(a),a.prop("_sprite",null,Fire.HideInInspector),a.getset("sprite",function(){return this._sprite},function(a){this._sprite=a,this._hasRenderObj&&Engine._renderContext.updateMaterial(this)},Fire.ObjectType(Fire.Sprite)),a.prop("_color",new Fire.Color(1,1,1,1),Fire.HideInInspector),a.getset("color",function(){return this._color},function(a){this._color=a,this._hasRenderObj&&Engine._renderContext.updateSpriteColor(this)}),a.prop("customSize_",!1,Fire.HideInInspector),a.getset("customSize",function(){return this.customSize_
},function(a){this.customSize_=a}),a.prop("width_",100,Fire.DisplayName("Width"),Fire.Watch("customSize_",function(a,b){b.disabled=!a.customSize_})),a.getset("width",function(){return this.customSize_?this.width_:Fire.isValid(this._sprite)?this._sprite.width:0},function(a){this.width_=a},Fire.HideInInspector),a.prop("height_",100,Fire.DisplayName("Height"),Fire.Watch("customSize_",function(a,b){b.disabled=!a.customSize})),a.getset("height",function(){return this.customSize_?this.height_:Fire.isValid(this._sprite)?this._sprite.height:0},function(a){this.height_=a},Fire.HideInInspector),a.prototype.onLoad=function(){Engine._renderContext.addSprite(this),this._hasRenderObj=!0},a.prototype.onEnable=function(){Engine._renderContext.show(this,!0)},a.prototype.onDisable=function(){Engine._renderContext.show(this,!1)},a.prototype.getWorldSize=function(){return new Fire.Vec2(this.width,this.height)};var b=new Fire.Matrix23;return a.prototype.onPreRender=function(){this.getSelfMatrix(b),this._sprite&&(b.a=this.width/this._sprite.width,b.d=this.height/this._sprite.height,this._sprite.rotated&&(b.b=b.d,b.c=-b.a,b.a=0,b.d=0,b.ty-=this.height)),b.prepend(this.transform._worldTransform),Engine._curRenderContext.updateTransform(this,b)},a.prototype.onDestroy=function(){Engine._renderContext.remove(this)},a.prototype.getSelfMatrix=function(a){var b=this.width,c=this.height,d=.5,e=.5;Fire.isValid(this._sprite)&&(d=this._sprite.pivot.x,e=this._sprite.pivot.y),a.a=1,a.b=0,a.c=0,a.d=1,a.tx=-d*b,a.ty=(1-e)*c},a}();Fire.SpriteRenderer=SpriteRenderer;var BitmapText=function(){var a=Fire.extend("Fire.BitmapText",Renderer,function(){RenderContext.initRenderer(this)});Fire.addComponentMenu(a,"BitmapText"),Fire.executeInEditMode(a),a.prop("_bitmapFont",null,Fire.HideInInspector),a.getset("bitmapFont",function(){return this._bitmapFont},function(a){this._bitmapFont=a,Engine._renderContext.updateBitmapFont(this)},Fire.ObjectType(Fire.BitmapFont)),a.prop("_text","Text",Fire.HideInInspector),a.getset("text",function(){return this._text},function(a){this._text!==a&&(this._text="string"==typeof a?a:""+a,Engine._renderContext.setText(this,this._text))},Fire.MultiText),a.prop("_anchor",Fire.TextAnchor.midCenter,Fire.HideInInspector),a.getset("anchor",function(){return this._anchor},function(a){this._anchor!==a&&(this._anchor=a)},Fire.Enum(Fire.TextAnchor)),a.prop("_align",Fire.TextAlign.left,Fire.HideInInspector),a.getset("align",function(){return this._align},function(a){this._align!==a&&(this._align=a,Engine._renderContext.setAlign(this,a))},Fire.Enum(Fire.TextAlign)),a.prototype.onLoad=function(){Engine._renderContext.addBitmapText(this)},a.prototype.onEnable=function(){Engine._renderContext.show(this,!0)},a.prototype.onDisable=function(){Engine._renderContext.show(this,!1)},a.prototype.onDestroy=function(){Engine._renderContext.remove(this)},a.prototype.getWorldSize=function(){return Engine._renderContext.getTextSize(this)};var b=new Fire.Matrix23;return a.prototype.onPreRender=function(){this.getSelfMatrix(b),b.prepend(this.transform._worldTransform),RenderContext.updateBitmapTextTransform(this,b)},a.prototype.getSelfMatrix=function(a){var b=Engine._renderContext.getTextSize(this),c=b.x,d=b.y,e=0,f=0;switch(this._anchor){case Fire.TextAnchor.topLeft:break;case Fire.TextAnchor.topCenter:e=c*-.5;break;case Fire.TextAnchor.topRight:e=-c;break;case Fire.TextAnchor.midLeft:f=.5*d;break;case Fire.TextAnchor.midCenter:e=c*-.5,f=.5*d;break;case Fire.TextAnchor.midRight:e=-c,f=.5*d;break;case Fire.TextAnchor.botLeft:f=d;break;case Fire.TextAnchor.botCenter:e=c*-.5,f=d;break;case Fire.TextAnchor.botRight:e=-c,f=d}a.a=1,a.b=0,a.c=0,a.d=1,a.tx=e,a.ty=f},a}();Fire.BitmapText=BitmapText;var Text=function(){var a=Fire.defineEnum({Arial:-1,Custom:-1}),b=new Fire.Matrix23,c=Fire.Class({name:"Fire.Text","extends":Renderer,constructor:function(){RenderContext.initRenderer(this)},properties:{_fontType:{"default":a.Arial,type:a},fontType:{get:function(){return this._fontType},set:function(a){this._fontType=a,Engine._renderContext.setTextStyle(this)},type:a},_customFontType:"Arial",customFontType:{get:function(){return this._customFontType},set:function(a){this._customFontType=a,Engine._renderContext.setTextStyle(this)},watch:{_fontType:function(b,c){c.disabled=b._fontType!==a.Custom}}},_text:"text",text:{get:function(){return this._text},set:function(a){this._text=a,Engine._renderContext.setTextContent(this,this._text)},multiline:!0},_size:30,size:{get:function(){return this._size},set:function(a){a!==this._size&&a>0&&(this._size=a,Engine._renderContext.setTextStyle(this))}},_color:Fire.Color.white,color:{get:function(){return this._color},set:function(a){this._color=a,Engine._renderContext.setTextStyle(this)}},_align:Fire.TextAlign.left,align:{get:function(){return this._align},set:function(a){this._align=a,Engine._renderContext.setTextStyle(this)},type:Fire.TextAlign},_anchor:Fire.TextAnchor.midCenter,anchor:{get:function(){return this._anchor},set:function(a){a!==this._anchor&&(this._anchor=a)},type:Fire.TextAnchor}},onLoad:function(){Engine._renderContext.addText(this)},onEnable:function(){Engine._renderContext.show(this,!0)},onDisable:function(){Engine._renderContext.show(this,!1)},onDestroy:function(){Engine._renderContext.remove(this)},getWorldSize:function(){return Engine._renderContext.getTextSize(this)},getSelfMatrix:function(a){var b=Engine._renderContext.getTextSize(this),c=b.x,d=b.y,e=0,f=0;switch(this._anchor){case Fire.TextAnchor.topLeft:break;case Fire.TextAnchor.topCenter:e=c*-.5;break;case Fire.TextAnchor.topRight:e=-c;break;case Fire.TextAnchor.midLeft:f=.5*d;break;case Fire.TextAnchor.midCenter:e=c*-.5,f=.5*d;break;case Fire.TextAnchor.midRight:e=-c,f=.5*d;break;case Fire.TextAnchor.botLeft:f=d;break;case Fire.TextAnchor.botCenter:e=c*-.5,f=d;break;case Fire.TextAnchor.botRight:e=-c,f=d}a.a=1,a.b=0,a.c=0,a.d=1,a.tx=e,a.ty=f},onPreRender:function(){this.getSelfMatrix(b),b.prepend(this.transform._worldTransform),RenderContext.updateTextTransform(this,b)}});return c.FontType=a,Fire.addComponentMenu(c,"Text"),Fire.executeInEditMode(c),c}();Fire.Text=Text;var Camera=Fire.Class({name:"Fire.Camera","extends":Component,constructor:function(){this._renderContext=null,this._contentStrategyInst=null},properties:{_background:Fire.Color.black,background:{get:function(){return this._background},set:function(a){this._background=a,this._renderContext&&(this._renderContext.background=a)}},_size:800,size:{get:function(){return this._size},set:function(a){this._size=a},tooltip:"The height of design resolution. Width varies depending on viewport's aspect ratio",watch:{_contentStrategy:function(a,b){b.disabled=a._contentStrategy===Fire.ContentStrategyType.NoScale}}},_contentStrategy:Fire.ContentStrategyType.FixedHeight,contentStrategy:{type:Fire.ContentStrategyType,get:function(){return this._contentStrategy},set:function(a){this._contentStrategy=a,this._contentStrategyInst=Fire.Screen.ContentStrategy.fromType(a)},displayName:"Scale Strategy",tooltip:"The type of scale strategy for this camera"},viewportInfo:{get:function(){var a=(this._renderContext||Engine._renderContext).size;return this._contentStrategyInst.apply(new Vec2(0,this._size),a)},visible:!1},renderContext:{set:function(a){this._renderContext=a},visible:!1}},onLoad:function(){this.entity._objFlags&HideInGame||(this.renderContext=Engine._renderContext),this._contentStrategyInst=Fire.Screen.ContentStrategy.fromType(this._contentStrategy)},onEnable:function(){this.entity._objFlags&HideInGame||(Engine._scene.camera=this,this._applyRenderSettings())},onDisable:function(){Engine._scene.camera===this&&(Engine._scene.camera=null),this._renderContext&&(this._renderContext.camera=null)},viewportToScreen:function(a,b){return this._renderContext?b=this._renderContext.size.scale(a,b):void Fire.error("Camera not yet inited.")},screenToViewport:function(a,b){if(b=b||new Vec2,!this._renderContext)return void Fire.error("Camera not yet inited.");var c=this._renderContext.size;return b.x=a.x/c.x,b.y=a.y/c.y,b},viewportToWorld:function(a,b){return b=this.viewportToScreen(a,b),this.screenToWorld(b,b)},screenToWorld:function(a,b){var c=(this._renderContext||Engine._renderContext).size.mul(.5),d=a.sub(c,c);d.y=-d.y;var e=new Matrix23,f=new Vec2;return this._calculateTransform(e,f),e.invert(),e.tx=f.x,e.ty=f.y,e.transformPoint(d,b)},worldToScreen:function(a,b){var c=new Matrix23,d=new Vec2;this._calculateTransform(c,d);var e=a.sub(d,d);b=c.transformPoint(e,b);var f=(this._renderContext||Engine._renderContext).size.y;return b.y=f-b.y,b},worldToViewport:function(a,b){return b=this.worldToScreen(a,b),this.screenToViewport(b,b)},_calculateTransform:function(a,b){var c=this.viewportInfo,d=c.scale,e=c.viewport,f=this.entity.transform,g=f.getLocalToWorldMatrix();b.x=g.tx,b.y=g.ty,a.identity(),a.tx=.5*e.width,a.ty=.5*e.height,a.a=d.x,a.d=d.y,a.rotate(g.getRotation())},_applyRenderSettings:function(){this._renderContext.background=this._background}});Fire.addComponentMenu(Camera,"Camera"),Fire.executeInEditMode(Camera),Fire.Camera=Camera;var MissingScript=function(){var a=Fire.extend("Fire.MissingScript",Component);return a.prototype.onLoad=function(){Fire.warn("The referenced script on this Component is missing!")},a}();Fire._MissingScript=MissingScript;var InteractionContext=function(){function a(){this.entities=[]}var b={},c={};return a.prototype._clear=function(){this.entities.length=0},a.prototype.pick=function(a){for(var d=this.entities.length-1;d>=0;--d){var e=this.entities[d];if(e.isValid){var f=b[e.id];if(f.contains(a)){var g=c[e.id],h=new Fire.Polygon(g);if(h.contains(a))return e}}}return null},a.prototype._updateRecursilvey=function(a){var d=a.getComponent(Fire.Renderer);if(d&&d._enabled){this.entities.push(a);var e=a.id;if(!c[e]){var f=d.getWorldOrientedBounds(),g=Math.calculateMaxRect(new Rect,f[0],f[1],f[2],f[3]);c[e]=f,b[e]=g}}for(var h=0,i=a._children.length;i>h;++h){var j=a._children[h];j._active&&this._updateRecursilvey(j)}},a.prototype.update=function(a){var d=!Engine.isPlaying||this===Engine._interactionContext;d&&(b={},c={}),this._clear();for(var e=0,f=a.length;f>e;++e){var g=a[e];g._active&&this._updateRecursilvey(g)}},a.prototype.getAABB=function(a){return b[a.id]},a.prototype.getOBB=function(a){return c[a.id]},a}();Fire._InteractionContext=InteractionContext;var Entity=Fire.Class({name:"Fire.Entity","extends":EventTarget,constructor:function(){var a=arguments[0];if(this._name="undefined"!=typeof a?a:"New Entity",this._objFlags|=Entity._defaultFlags,Fire._isCloning)this._activeInHierarchy=!1;else{this._activeInHierarchy=!0;var b=new Transform;b.entity=this,this._components=[b],this.transform=b,Engine._scene&&Engine._scene.appendRoot(this),Engine._canModifyCurrentScene&&(Engine._renderContext.onRootEntityCreated(this),b._onEntityActivated(!0))}},properties:{name:{get:function(){return this._name},set:function(a){this._name=a}},active:{get:function(){return this._active},set:function(a){if(this._active!=a){this._active=a;var b=!this._parent||this._parent._activeInHierarchy;b&&this._onActivatedInHierarchy(a)}}},activeInHierarchy:{get:function(){return this._activeInHierarchy}},transform:{"default":null,visible:!1},parent:{get:function(){return this._parent},set:function(a){if(this._parent!==a){if(a===this)return void Fire.warn("A entity can't be set as the parent of itself.");if(a&&!(a instanceof Entity))return void Fire.error(a instanceof Transform?"Entity.parent can not be a Transform, use transform.entity instead.":"Entity.parent must be instance of Entity (or must be null)");var b=this._parent;if(a){if(a._objFlags&HideInGame&&!(this._objFlags&HideInGame))return void Fire.error("Failed to set parent, the child's HideInGame must equals to parent's.");if(a._objFlags&HideInEditor&&!(this._objFlags&HideInEditor))return void Fire.error("Failed to set parent, the child's HideInEditor must equals to parent's.");b||Engine._scene.removeRoot(this),a._children.push(this)}else Engine._scene.appendRoot(this);this._parent=a||null,this.transform._parent=this._parent&&this._parent.transform,!b||b._objFlags&Destroying||(b._children.splice(b._children.indexOf(this),1),this._onHierarchyChanged(b)),Engine._renderContext.onEntityParentChanged(this,b)}}},childCount:{get:function(){return this._children.length},visible:!1},dontDestroyOnLoad:{get:function(){return!!(this._objFlags|DontDestroy)},set:function(a){a?this._objFlags|=DontDestroy:this._objFlags&=~DontDestroy}},_active:!0,_parent:null,_children:[],_components:null},destroy:function(){FObject.prototype.destroy.call(this)&&this._activeInHierarchy&&this._deactivateChildComponents()},_onPreDestroy:function(){var a=this._parent;this._objFlags|=Destroying;var b=!(a&&a._objFlags&Destroying);b&&Engine._renderContext.onEntityRemoved(this);for(var c=0;c<this._components.length;++c){var d=this._components[c];d._destroyImmediate()}a?b&&a._children.splice(a._children.indexOf(this),1):Engine._scene.removeRoot(this);for(var e=this._children,f=0,g=e.length;g>f;++f)e[f]._destroyImmediate()},_getCapturingTargets:function(a,b){for(var c=this._parent;c;c=c._parent)c._activeInHierarchy&&c._capturingListeners&&c._capturingListeners.has(a)&&b.push(c)},_getBubblingTargets:function(a,b){for(var c=this._parent;c;c=c._parent)c._activeInHierarchy&&c._bubblingListeners&&c._bubblingListeners.has(a)&&b.push(c)},_doSendEvent:function(a){this._activeInHierarchy&&Entity.$super.prototype._doSendEvent.call(this,a)},addComponent:function(a){var b;if("string"==typeof a){if(b=JS.getClassByName(a),!b)return Fire.error('[addComponent] Failed to get class "%s"'),_requiringFrames.length>0&&Fire.error("You should not add component when the scripts are still loading.",a),null}else{if(!a)return Fire.error("[addComponent] Type must be non-nil"),null;b=a}if(this._objFlags&Destroying)return Fire.error("isDestroying"),null;if("function"!=typeof b)return Fire.error("The component to add must be a constructor"),null;var c=new b;return c.entity=this,this._components.push(c),this._activeInHierarchy&&c._onEntityActivated(!0),c},getComponent:function(a){if(!a)return void Fire.error("Argument must be non-nil");var b;b="string"==typeof a?JS.getClassByName(a):a;for(var c=0;c<this._components.length;++c){var d=this._components[c];if(d instanceof b)return d}return null},_removeComponent:function(a){if(!(this._objFlags&Destroying)){var b=this._components.indexOf(a);-1!==b?(this._components.splice(b,1),a.entity=null):a.entity!==this&&Fire.error("Component not owned by this entity")}},find:function(a){if(!a&&""!==a)return void Fire.error("Argument must be non-nil");if("/"===a[0])return void Fire.error("Path should not start with a '/' character, please use \"Fire.Entity.find\" instead");for(var b=a.split("/"),c=this,d=0,e=0,f=null,g=null,h=0;h<b.length;h++){var i=b[h];if(".."===i){if(!c)return null;c=c._parent}else{for(f=c?c._children:Engine._scene.entities,c=null,d=0,e=f.length;e>d;++d)g=f[d],g.name===i&&(c=g);if(!c)return null}}return c},getChild:function(a){return this._children[a]},getChildren:function(){return this._children.slice()},isChildOf:function(a){var b=this;do{if(b===a)return!0;b=b._parent}while(b);return!1},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):Engine._scene.entities.indexOf(this)},getSibling:function(a){return this._parent?this._parent._children[a]:Engine._scene.entities[a]},setSiblingIndex:function(a){var b=this._parent?this._parent._children:Engine._scene.entities,c=this;a=-1!==a?a:b.length-1;var d=b.indexOf(c);a!==d&&(b.splice(d,1),a<b.length?b.splice(a,0,c):b.push(c),Engine._renderContext.onEntityIndexChanged(this,d,a))},setAsFirstSibling:function(){this.setSiblingIndex(0)},setAsLastSibling:function(){this.setSiblingIndex(-1)},_onActivatedInHierarchy:function(a){this._activeInHierarchy=a;for(var b=this._components.length,c=0;b>c;++c){var d=this._components[c];d._onEntityActivated(a)}for(var e=0,f=this.childCount;f>e;++e){var g=this._children[e];g._active&&g._onActivatedInHierarchy(a)}},_deactivateChildComponents:function(){for(var a=this._components.length,b=0;a>b;++b){var c=this._components[b];c._onEntityActivated(!1)}for(var d=0,e=this.childCount;e>d;++d){var f=this._children[d];f._active&&f._deactivateChildComponents()}},_onHierarchyChanged:function(a){var b=this._active&&(!a||a._activeInHierarchy),c=this._active&&(!this._parent||this._parent._activeInHierarchy);b!==c&&this._onActivatedInHierarchy(c)},_instantiate:function(a,b){var c=this._parent;this._parent=null;var d=Fire._doInstantiate(this);return this._parent=c,Engine.isPlaying&&(d._name=this._name+"(Clone)"),a&&(d.transform._position=a),b&&(d.transform._rotation=b),Engine._scene&&Engine._scene.appendRoot(d),Engine._renderContext.onEntityCreated(d,!0),d._active&&d._onActivatedInHierarchy(!0),d}});Entity._defaultFlags=0,Entity.find=function(a){return a||""===a?"/"!==a[0]?(Fire.error("Path must start with a '/' character"),null):Engine._scene.findEntity(a):(Fire.error("Argument must be non-nil"),null)},Fire.Entity=Entity;var Scene=function(){var Scene=Fire.Class({name:"Fire.Scene","extends":Asset,properties:{entities:[],camera:null}}),visitOperationTmpl="if(c._enabled && c._FUNC_) c._FUNC_();",visitFunctionTmpl="(function(e){	var i, len=e._components.length;	for(i=0;i<len;++i){		var c=e._components[i];		"+visitOperationTmpl+"	}	var cs=e._children;	for(i=0,len=cs.length;i<len;++i){		var sub=cs[i];		if(sub._active) _FUNC_Recursively(sub);	}})",updateRecursively=eval(visitFunctionTmpl.replace(/_FUNC_/g,"update")),lateUpdateRecursively=eval(visitFunctionTmpl.replace(/_FUNC_/g,"lateUpdate")),onPreRenderRecursively=eval(visitFunctionTmpl.replace(/_FUNC_/g,"onPreRender"));return Scene.prototype.update=function(){for(var a=this.entities,b=0,c=a.length;c>b;++b)Component._invokeStarts(a[b]);for(b=0,c=a.length;c>b;++b)a[b]._active&&updateRecursively(a[b]);for(b=0,c=a.length;c>b;++b)a[b]._active&&lateUpdateRecursively(a[b])},Scene.prototype.render=function(a){Engine._curRenderContext=a,this.updateTransform(a.camera||this.camera);for(var b=this.entities,c=0,d=b.length;d>c;++c)b[c]._active&&onPreRenderRecursively(b[c]);a.render(),Engine._curRenderContext=null},Scene.prototype.updateTransform=function(a){var b,c,d=this.entities;if(a){var e=new Matrix23,f=new Vec2;a._calculateTransform(e,f);var g=-f.x,h=-f.y;for(b=0,c=d.length;c>b;++b){var i=d[b].transform._position,j=i.x,k=i.y;i.x+=g,i.y+=h,d[b].transform._updateTransform(e),i.x=j,i.y=k}}else for(b=0,c=d.length;c>b;++b)d[b].transform._updateRootTransform()},Scene.prototype.appendRoot=function(a){this.entities.push(a)},Scene.prototype.removeRoot=function(a){var b=this.entities;if(b.length>0&&b[b.length-1]===a)return void b.pop();var c=b.indexOf(a);-1!==c?b.splice(c,1):Fire.error("entity "+a+" not contains in roots of hierarchy, is may caused if entity not destroyed immediate before current scene changed")},Scene.prototype.findEntity=function(a){for(var b=a.split("/"),c=null,d=b[1],e=this.entities,f=0;f<e.length;f++)if(e[f].isValid&&e[f]._name===d){c=e[f];break}if(!c)return null;var g=2;for(g;g<b.length;g++){d=b[g];var h=c._children;c=null;for(var i=0,j=h.length;j>i;++i){var k=h[i];if(k.name===d){c=k;break}}if(!c)return null}return c},Scene.prototype.activate=function(){for(var a=this.entities,b=0,c=a.length;c>b;++b){var d=a[b];d._active&&d._onActivatedInHierarchy(!0)}if(Engine.isPlaying)for(b=0,c=a.length;c>b;++b)Component._invokeStarts(a[b])},Scene.prototype.destroy=function(){for(var a=this.entities,b=0,c=a.length;c>b;++b){var d=a[b];d.isValid&&(d._objFlags&DontDestroy?Engine._dontDestroyEntities.push(d):d.destroy())}Asset.prototype.destroy.call(this)},Scene}();Fire._Scene=Scene;var LoadManager=function(){function a(){return{image:{loader:ImageLoader,defaultExtname:".host"},json:{loader:JsonLoader,defaultExtname:".json"},text:{loader:TextLoader,defaultExtname:".txt"}}}function b(a,b,c){f._curConcurrent+=1,a(b,function(a,b){c(a,b),f._curConcurrent=Math.max(0,f._curConcurrent-1),e()})}var c=new Fire.CallbacksInvoker,d=[],e=function(){if(f._curConcurrent>=f.maxConcurrent)return void Fire.error("too many concurrent requests");var a=d.pop();a&&b(a.loader,a.url,a.callback)},f={maxConcurrent:2,_curConcurrent:0,loadByLoader:function(a,e,f){if(c.add(e,f)){var g=c.bindKey(e,!0);this._curConcurrent<this.maxConcurrent?b(a,e,g):d.push({url:e,loader:a,callback:g})}},load:function(a,b,c,d){"function"==typeof c&&(d=c);var e=this._rawTypes[b];if(e){var f=c?"."+c:e.defaultExtname;if(f){var g=a+f;this.loadByLoader(e.loader,g,d)}else d("Undefined extname for the raw "+b+" file of "+a,null)}else d('Unknown raw type "'+b+'" of '+a,null)},_rawTypes:a(),registerRawTypes:function(a,b,c){return this._rawTypes[a]?void Fire.error('rawType "%s" has already defined',a):(c&&"."!==c[0]&&(c="."+c),void(this._rawTypes[a]={loader:b,defaultExtname:c}))},_loadFromXHR:_LoadFromXHR};return f._urlToCallbacks=c,f}();Fire.LoadManager=LoadManager;var AssetLibrary=function(){function a(a,b){this.readMainCache=a,this.writeMainCache=b;var c=!(this.readMainCache&&this.writeMainCache);this.taskIndieCache=c?{}:null}var b="",c=new Fire.CallbacksInvoker,d=new Fire._DeserializeInfo;a.prototype.readCache=function(a){return this.readMainCache&&this.writeMainCache?e._uuidToAsset[a]:this.readMainCache?e._uuidToAsset[a]||this.taskIndieCache[a]:this.taskIndieCache[a]},a.prototype.writeCache=function(a,b){this.writeMainCache&&(e._uuidToAsset[a]=b),this.taskIndieCache&&(this.taskIndieCache[a]=b)};var e={loadAsset:function(b,c,d,e,f){d="undefined"!=typeof d?d:!0,e="undefined"!=typeof e?e:!0;var g=new a(d,e);this._loadAssetByUuid(b,c,g,f)},_LoadingHandle:a,_loadAssetByUuid:function(a,d,f,g){if("string"!=typeof a)return void(d&&d("[AssetLibrary] uuid must be string",null));if(!g){var h=f.readCache(a);if(h)return void(d&&d(null,h))}var i=f.readMainCache&&!g;if(!i||c.add(a,d)){var j=b+a.substring(0,2)+Fire.Path.sep+a;LoadManager.loadByLoader(JsonLoader,j,function(b,h){function k(b,e){e&&(e._uuid=a,f.writeCache(a,e)),i?c.invokeAndRemove(a,b,e):d&&d(b,e)}h?e._deserializeWithDepends(h,j,k,f,g):k(b,null)})}},loadJson:function(b,c,d){var e=new a(!d,!d);this._deserializeWithDepends(b,"",c,e)},_deserializeWithDepends:function(a,b,c,f,g){var h=a&&a[0]&&a[0].__type__===JS._getClassId(Scene),i=h?Fire._MissingScript.safeFindClass:function(a){var b=JS._getClassById(a);return b?b:(Fire.warn('Can not get class "%s"',a),Object)};Engine._canModifyCurrentScene=!1;var j=Fire.deserialize(a,d,{classFinder:i,target:g});Engine._canModifyCurrentScene=!0;var k=d.uuidList.length,l=d.rawProp;if(l){var m=Fire.attr(j.constructor,d.rawProp),n=m.rawType;++k,LoadManager.load(b,n,j._rawext,function(a,d){a&&Fire.error("[AssetLibrary] Failed to load %s of %s. %s",n,b,a),j[l]=d,--k,0===k&&c(null,j)})}0===k&&c(null,j);for(var o=0,p=d.uuidList.length;p>o;o++){var q=d.uuidList[o],r=function(a,b,d){return function(a,e){b[d]=e,--k,0===k&&c(null,j)}}(q,d.uuidObjList[o],d.uuidPropList[o]);e._loadAssetByUuid(q,r,f),invokeCbByDepends=!0}d.reset()},getAssetByUuid:function(a){return e._uuidToAsset[a]||null},unloadAsset:function(a,b){var c;c="string"==typeof a?e._uuidToAsset[a]:a,c&&(b&&c.isValid&&(c.destroy(),FObject._deferredDestroy()),delete e._uuidToAsset[c._uuid])},init:function(a){b=Fire.Path.setEndWithSep(a)}};return e._uuidToAsset={},Asset.prototype._onPreDestroy=function(){e._uuidToAsset[this._uuid]===this&&e.unloadAsset(this,!1)},e}();Fire.AssetLibrary=AssetLibrary;var Engine=function(){function a(){d._scene.render(d._renderContext)}function b(b){d._scene&&(b&&(d._scene.update(),FObject._deferredDestroy()),a(),d._interactionContext.update(d._scene.entities))}function c(){if(e){i=Ticker.requestAnimationFrame(c);var a=!f||g;g=!1;var d=Ticker.now();Time._update(d,!a),b(a)}}var d={},e=!1,f=!1,g=!1,h="",i=-1;d._scene=null,d._dontDestroyEntities=[],d._renderContext=null,d._interactionContext=null,d._curRenderContext=null,d._inputContext=null,Object.defineProperty(d,"isPlaying",{get:function(){return e}}),Object.defineProperty(d,"isPaused",{get:function(){return f}}),Object.defineProperty(d,"loadingScene",{get:function(){return h}});var j=null;Object.defineProperty(d,"_canModifyCurrentScene",{get:function(){return!j},set:function(a){a?(this._scene=j,j=null):(this._scene&&j&&Fire.error("another scene still locked: "+j.name),j=this._scene,this._scene=null)}});var k=!1;return Object.defineProperty(d,"inited",{get:function(){return k}}),d._sceneInfos={},d.init=function(a,b,c,e){return k?void Fire.error("Engine already inited"):(k=!0,d._renderContext=new Fire._Runtime.RenderContext(a,b,c),d._interactionContext=new InteractionContext,e&&JS.mixin(d._sceneInfos,e.scenes),d._renderContext)},d.play=function(){if(e&&!f)return void Fire.warn("Fireball is already playing");if(e&&f)return void(f=!1);e=!0,d._inputContext=new InputContext(d._renderContext);var a=Ticker.now();Time._restart(a),c()},d.stop=function(){e&&(FObject._deferredDestroy(),d._inputContext.destruct(),d._inputContext=null,Input._reset(),e=!1,f=!1,h="",-1!==i&&(Ticker.cancelAnimationFrame(i),i=-1))},d.pause=function(){f=!0},d.step=function(){this.pause(),g=!0,e||d.play()},d.update=c,d._launchScene=function(a,b){if(!a)return void Fire.error("Argument must be non-nil");d._dontDestroyEntities.length=0;var c=d._scene;Fire.isValid(c)&&AssetLibrary.unloadAsset(c,!0),FObject._deferredDestroy(),d._scene=null,b&&b(),d._renderContext.onSceneLoaded(a),a.entities=a.entities.concat(d._dontDestroyEntities),d._dontDestroyEntities.length=0,d._scene=a,d._renderContext.onSceneLaunched(a),a.activate()},d.loadScene=function(a,b,c){if(h)return Fire.error('[Engine.loadScene] Failed to load scene "%s" because "%s" is already loading',a,h),!1;var e=d._sceneInfos[a];return e?(h=a,d._loadSceneByUuid(e,b,c),!0):(Fire.error('[Engine.loadScene] The scene "%s" can not be loaded because it has not been added to the build settings.',a),!1)},d._loadSceneByUuid=function(a,b,c){AssetLibrary.unloadAsset(a),AssetLibrary.loadAsset(a,function(e,f){e?e="Failed to load scene: "+e:f instanceof Fire._Scene||(e="The asset "+a+" is not a scene",f=null),f?d._launchScene(f,c):Fire.error(e),h="",b&&b(f,e)})},d.preloadScene=function(a,b){var c=d._sceneInfos[a];c?(AssetLibrary.unloadAsset(c),AssetLibrary.loadAsset(c,b)):Fire.error('[Engine.preloadScene] The scene "%s" could not be loaded because it has not been added to the build settings.',a)},d}();Fire.Engine=Engine;var ModifierKeyStates=function(){function a(a){Fire.Event.call(this,a,!0),this.nativeEvent=null,this.ctrlKey=!1,this.shiftKey=!1,this.altKey=!1,this.metaKey=!1}return JS.extend(a,Fire.Event),a.prototype.getModifierState=function(a){return nativeEvent.getModifierState(a)},a.prototype.initFromNativeEvent=function(a){this.nativeEvent=a,this.ctrlKey=a.ctrlKey,this.shiftKey=a.shiftKey,this.altKey=a.altKey,this.metaKey=a.metaKey},a.prototype._reset=function(){Event.prototype._reset.call(this),this.nativeEvent=null,this.ctrlKey=!1,this.shiftKey=!1,this.altKey=!1,this.metaKey=!1},a}();Fire.ModifierKeyStates=ModifierKeyStates,Fire.KeyboardEvent=window.KeyboardEvent;var MouseEvent=function(){function a(a){Fire.ModifierKeyStates.call(this,a),this.button=0,this.buttonStates=0,this.screenX=0,this.screenY=0,this.deltaX=0,this.deltaY=0,this.relatedTarget=null}return JS.extend(a,ModifierKeyStates),a.prototype.initFromNativeEvent=function(a){ModifierKeyStates.prototype.initFromNativeEvent.call(this,a),this.button=a.button,this.buttonStates=a.buttons,this.screenX=a.offsetX,this.screenY=a.offsetY,this.deltaX=a.movementX,this.deltaY=a.movementY,this.relatedTarget=a.relatedTarget},a.prototype.clone=function(){var b=new a(this.type);return b.bubbles=this.bubbles,b.ctrlKey=this.ctrlKey,b.shiftKey=this.shiftKey,b.altKey=this.altKey,b.metaKey=this.metaKey,b.button=this.button,b.buttonStates=this.buttonStates,b.screenX=this.screenX,b.screenY=this.screenY,b.deltaX=this.deltaX,b.deltaY=this.deltaY,b.relatedTarget=this.relatedTarget,b},a.prototype._reset=function(){ModifierKeyStates.prototype._reset.call(this),this.button=0,this.buttonStates=0,this.screenX=0,this.screenY=0,this.deltaX=0,this.deltaY=0,this.relatedTarget=null},a}();Fire.MouseEvent=MouseEvent;var InputContext=function(){function a(a){this.target=a,this.events=[]}function b(a){a.screenX*=Fire.Screen.devicePixelRatio,a.screenY*=Fire.Screen.devicePixelRatio}a.prototype.addEventListener=function(a,b,c){this.target.addEventListener(a,b,c),this.events.push([a,b,c])},a.prototype.removeAll=function(){for(var a=0;a<this.events.length;a++){var b=this.events[a];this.target.removeEventListener(b[0],b[1],b[2])}this.events.length=0};var c=function(b){function c(a){f.onDomInputEvent(a)}function d(){e.focus()}var e=b.canvas;e.tabIndex=e.tabIndex||0,this.renderContext=b,this.eventRegister=new a(e),this.hasTouch="ontouchstart"in window;var f=this;for(var g in EventRegister.inputEvents)this.eventRegister.addEventListener(g,c,!0);this.hasTouch&&this.simulateMouseEvent(),this.hasTouch?this.eventRegister.addEventListener("touchstart",d,!0):this.eventRegister.addEventListener("mousedown",d,!0)};return c.prototype.simulateMouseEvent=function(){function a(a,b){var c=new MouseEvent(a);c.bubbles=!0;var d=b.changedTouches[0]||b.touches[0];return c.button=0,c.buttonStates=1,d&&(c.screenX=d.pageX-e,c.screenY=d.pageY-f),c}function c(c){var e=c.simulateType;return e?function(c){var f=a(e,c);b(f),Input._dispatchEvent(f,d),c.preventDefault(),f._propagationStopped&&(f._propagationImmediateStopped?c.stopImmediatePropagation():c.stopPropagation())}:function(a){a.preventDefault()}}for(var d=this,e=0,f=0,g=d.renderContext.canvas;g;)e+=parseInt(g.offsetLeft),f+=parseInt(g.offsetTop),g=g.offsetParent;var h={touchstart:{simulateType:"mousedown"},touchend:{simulateType:"mouseup"},touchmove:{simulateType:"mousemove"},touchcancel:{simulateType:""}};for(var i in h){var j=h[i];this.eventRegister.addEventListener(i,c(j),!0)}},c.prototype.destruct=function(){this.eventRegister.removeAll()},c.prototype.onDomInputEvent=function(a){var c,d=EventRegister.inputEvents[a.type],e=d.constructor;e?(c=new e(a.type),c.initFromNativeEvent&&c.initFromNativeEvent(a),c.bubbles=d.bubbles):c=a,c instanceof MouseEvent&&b(c),Input._dispatchEvent(c,this),c._defaultPrevented&&a.preventDefault(),c._propagationStopped&&(c._propagationImmediateStopped?a.stopImmediatePropagation():a.stopPropagation())},c}(),Browser=function(){var a=window,b=a.navigator,c=document,d=(c.documentElement,b.userAgent.toLowerCase()),e={};e.BROWSER_TYPE_WECHAT="wechat",e.BROWSER_TYPE_ANDROID="androidbrowser",e.BROWSER_TYPE_IE="ie",e.BROWSER_TYPE_QQ="qqbrowser",e.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",e.BROWSER_TYPE_UC="ucbrowser",e.BROWSER_TYPE_360="360browser",e.BROWSER_TYPE_BAIDU_APP="baiduboxapp",e.BROWSER_TYPE_BAIDU="baidubrowser",e.BROWSER_TYPE_MAXTHON="maxthon",e.BROWSER_TYPE_OPERA="opera",e.BROWSER_TYPE_OUPENG="oupeng",e.BROWSER_TYPE_MIUI="miuibrowser",e.BROWSER_TYPE_FIREFOX="firefox",e.BROWSER_TYPE_SAFARI="safari",e.BROWSER_TYPE_CHROME="chrome",e.BROWSER_TYPE_LIEBAO="liebao",e.BROWSER_TYPE_QZONE="qzone",e.BROWSER_TYPE_SOUGOU="sogou",e.BROWSER_TYPE_UNKNOWN="unknown";var f=e.BROWSER_TYPE_UNKNOWN,g=d.match(/sogou|qzone|liebao|micromessenger|qqbrowser|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|trident|oupeng|opera|miuibrowser|firefox/i)||d.match(/chrome|safari/i);return g&&g.length>0?(f=g[0],"micromessenger"===f?f=e.BROWSER_TYPE_WECHAT:"safari"===f&&d.match(/android.*applewebkit/)?f=e.BROWSER_TYPE_ANDROID:"trident"===f?f=e.BROWSER_TYPE_IE:"360 aphone"===f&&(f=e.BROWSER_TYPE_360)):d.indexOf("iphone")&&d.indexOf("mobile")&&(f="safari"),e.type=f,e}(),BrowserGetter=function(){var a={init:function(){this.html=document.getElementsByTagName("html")[0]},availWidth:function(a){return a&&a!==this.html?a.clientWidth:window.innerWidth},availHeight:function(a){return a&&a!==this.html?a.clientHeight:window.innerHeight},adaptationType:Browser.type};switch(window.navigator.userAgent.indexOf("OS 8_1_")>-1&&(a.adaptationType=Browser.BROWSER_TYPE_MIUI),a.adaptationType){case Browser.BROWSER_TYPE_SAFARI:a.availWidth=function(a){return a.clientWidth
},a.availHeight=function(a){return a.clientHeight};break;case Browser.BROWSER_TYPE_SOUGOU:case Browser.BROWSER_TYPE_UC:a.availWidth=function(a){return a.clientWidth},a.availHeight=function(a){return a.clientHeight}}return a.init(),a}(),Screen={devicePixelRatio:Fire.isRetinaEnabled&&window.devicePixelRatio||1};Object.defineProperty(Screen,"size",{get:function(){return Engine._renderContext.size},set:function(a){Engine._renderContext.size=a}}),Object.defineProperty(Screen,"width",{get:function(){return Engine._renderContext.width},set:function(a){Engine._renderContext.width=a}}),Object.defineProperty(Screen,"height",{get:function(){return Engine._renderContext.height},set:function(a){Engine._renderContext.height=a}}),Object.defineProperty(Screen,"_container",{get:function(){var a=Fire.Engine._renderContext.canvas;return a.parentNode}}),Object.defineProperty(Screen,"_frame",{get:function(){var a=this._container;return a.parentNode===document.body?document.documentElement:a.parentNode}}),Object.defineProperty(Screen,"_frameSize",{get:function(){var a=this._frame;return Fire.v2(BrowserGetter.availWidth(a),BrowserGetter.availHeight(a))}}),Fire.Screen=Screen,ContainerStrategy.prototype.setupContainer=function(a){var b=Fire.Engine._renderContext.canvas,c=Fire.Screen._container;c.style.width=b.style.width=a.x+"px",c.style.height=b.style.height=a.y+"py";var d=Fire.Screen.devicePixelRatio;if(Fire.Screen.size=a.mul(d),Fire.isMobile){var e,f=document.body;f&&(e=f.style)&&["paddingTop","paddingRight","paddingBottom","paddingLeft","borderTop","borderRight","borderBottom","borderLeft","marginTop","marginRight","marginBottom","marginLeft"].forEach(function(a){e[a]=e[a]||"0px"})}},Fire.Screen.ContainerStrategy=ContainerStrategy,ContentStrategy.prototype.apply=function(){},ContentStrategy.prototype.buildResult=function(a,b,c){Math.abs(a.x-b.x)<2&&(b.x=a.x),Math.abs(a.y-b.y)<2&&(b.y=a.y);var d=new Fire.Rect(Math.round((a.x-b.x)/2),Math.round((a.y-b.y)/2),b.x,b.y);return{scale:c,viewport:d}},ContentStrategy.prototype.getContainerSize=function(){var a=Fire.Scene._container;return Fire.v2(a.clientWidth,a.clientHeight)},Fire.Screen.ContentStrategy=ContentStrategy,function(){function a(){ContainerStrategy.call(this)}function b(){ContentStrategy.call(this)}function c(){ContentStrategy.call(this)}Fire.JS.extend(a,ContainerStrategy),a.prototype.apply=function(){var a=Fire.Screen._frameSize;this.setupContainer(a)},ContainerStrategy.EqualToFrame=new a,Fire.JS.extend(b,ContentStrategy),b.prototype.apply=function(a,b){return this.buildResult(b,b,Vec2.one)},Fire.JS.extend(c,ContentStrategy),c.prototype.apply=function(a,b){var c=b.y/a.y;return this.buildResult(b,b,Fire.v2(c,c))};var d=[new b,new c];ContentStrategy.fromType=function(a){var b=d[a];return b?b:(Fire.error("Failed to get ContentStrategy from value",a),d[1])}}();var FireMouseEvent=Fire.MouseEvent,EventRegister={inputEvents:{keydown:{constructor:null,bubbles:!0,cancelable:!0},keyup:{constructor:null,bubbles:!0,cancelable:!0},click:{constructor:FireMouseEvent,bubbles:!0,cancelable:!0},dblclick:{constructor:FireMouseEvent,bubbles:!0,cancelable:!1},mousedown:{constructor:FireMouseEvent,bubbles:!0,cancelable:!0},mouseup:{constructor:FireMouseEvent,bubbles:!0,cancelable:!0},mousemove:{constructor:FireMouseEvent,bubbles:!0,cancelable:!0},mouseenter:{constructor:FireMouseEvent,bubbles:!1,cancelable:!1},mouseleave:{constructor:FireMouseEvent,bubbles:!1,cancelable:!1}}};Fire.EventRegister=EventRegister;var Input=function(){var a={_eventListeners:new EventListeners,_lastTarget:null};return Object.defineProperty(a,"hasTouch",{get:function(){return!!Engine._inputContext&&Engine._inputContext.hasTouch}}),a.on=function(a,b){b?this._eventListeners.add(a,b):Fire.error("Callback must be non-nil")},a.off=function(a,b){b?this._eventListeners.remove(a,b)||Fire.warn("Callback not exists"):Fire.error("Callback must be non-nil")},a._reset=function(){this._eventListeners=new EventListeners,this._lastTarget=null},a._dispatchMouseEvent=function(a,b){var c=b.renderContext.camera||Engine._scene.camera,d=c.screenToWorld(new Vec2(a.screenX,a.screenY)),e=Engine._interactionContext.pick(d);if(a.target=e,this._eventListeners.invoke(a),this._lastTarget&&this._lastTarget!==e){var f=a.clone();f.type="mouseleave",f.bubbles=EventRegister.inputEvents.mouseleave.bubbles,this._lastTarget.dispatchEvent(f)}if(e&&(e.dispatchEvent(a),this._lastTarget!==e)){var g=a.clone();g.type="mouseenter",g.bubbles=EventRegister.inputEvents.mouseenter.bubbles,e.dispatchEvent(g)}this._lastTarget=e},a._dispatchEvent=function(a,b){a instanceof Fire.MouseEvent?this._dispatchMouseEvent(a,b):this._eventListeners.invoke(a)},a}();Fire.Input=Input,Fire.isIOS&&Fire.LoadManager.load("empty","audio","mp3",function(a,b){var c=!1;window.addEventListener("touchstart",function d(){if(!c){c=!0;var a=new Fire.AudioSource,e=new Fire.AudioClip;e.rawData=b,a.clip=e,Fire.AudioContext.play(a),window.removeEventListener("touchstart",d)}})}),function(){function a(a,b){var c=document.createElement("audio");if(Browser.type===Browser.BROWSER_TYPE_IE)var e=setInterval(function(){c.readyState===d&&(b(null,c),clearInterval(e))},100);else c.addEventListener("canplaythrough",function(){b(null,c)},!1);c.addEventListener("error",function(c){b('LoadAudioClip: "'+a+'" seems to be unreachable or the file is empty. InnerMessage: '+c+"\n This may caused by fireball-x/dev#267",null)},!1),c.src=a}var b=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;if(!b){var c={},d=4;Fire.LoadManager.registerRawTypes("audio",a),c.initSource=function(a){a._audio=null},c.getCurrentTime=function(a){return a&&a._audio&&a._playing?a._audio.currentTime:0},c.updateTime=function(a,b){a&&a._audio&&(a._audio.duration,a._audio.currentTime=b)},c.updateMute=function(a){a&&a._audio&&(a._audio.muted=a.mute)},c.updateVolume=function(a){a&&a._audio&&(a._audio.volume=a.volume)},c.updateLoop=function(a){a&&a._audio&&(a._audio.loop=a.loop)},c.updatePlaybackRate=function(a){this.isPaused||(this.pause(a),this.play(a))},c.updateAudioClip=function(a){a&&a.clip&&(a._audio=a.clip.rawData)},c.pause=function(a){a._audio&&a._audio.pause()},c.stop=function(a){a._audio&&(a._audio.pause(),a._audio.currentTime=0,a._audio.onended&&a._audio.removeEventListener("ended",a._audio.onended))},c.play=function(a){a&&a.clip&&a.clip.rawData&&(!a._playing||a._paused)&&(this.updateAudioClip(a),this.updateVolume(a),this.updateLoop(a),this.updateMute(a),this.playbackRate=a.playbackRate,a._audio.play(),a._audio.onended=function(){a._onPlayEnd().bind(a)}.bind(a),a._audio.addEventListener("ended",a._audio.onended))},c.getClipBuffer=function(){return Fire.error("Audio does not contain the <Buffer> attribute!"),null},c.getClipLength=function(a){return a.rawData.duration},c.getClipSamples=function(){return Fire.error("Audio does not contain the <Samples> attribute!"),null},c.getClipChannels=function(){return Fire.error("Audio does not contain the <Channels> attribute!"),null},c.getClipFrequency=function(){return Fire.error("Audio does not contain the <Frequency> attribute!"),null},Fire.AudioContext=c}}();var AudioSource=function(){var a=Fire.Class({name:"Fire.AudioSource","extends":Fire.Component,constructor:function(){this._playing=!1,this._paused=!1,this._startTime=0,this._lastPlay=0,this._buffSource=null,this._volumeGain=null,this.onEnd=null},properties:{isPlaying:{get:function(){return this._playing&&!this._paused},visible:!1},isPaused:{get:function(){return this._paused},visible:!1},time:{get:function(){return Fire.AudioContext.getCurrentTime(this)},set:function(a){Fire.AudioContext.updateTime(this,a)},visible:!1},_clip:{"default":null,type:Fire.AudioClip},clip:{get:function(){return this._clip},set:function(a){this._clip!==a&&(this._clip=a,Fire.AudioContext.updateAudioClip(this))}},_loop:!1,loop:{get:function(){return this._loop},set:function(a){this._loop!==a&&(this._loop=a,Fire.AudioContext.updateLoop(this))}},_mute:!1,mute:{get:function(){return this._mute},set:function(a){this._mute!==a&&(this._mute=a,Fire.AudioContext.updateMute(this))}},_volume:1,volume:{get:function(){return this._volume},set:function(a){this._volume!==a&&(this._volume=Math.clamp01(a),Fire.AudioContext.updateVolume(this))},range:[0,1]},_playbackRate:1,playbackRate:{get:function(){return this._playbackRate},set:function(a){this._playbackRate!==a&&(this._playbackRate=a,this._playing&&Fire.AudioContext.updatePlaybackRate(this))}},playOnLoad:!0},_onPlayEnd:function(){this.onEnd&&this.onEnd(),this._playing=!1,this._paused=!1},pause:function(){this._paused||(Fire.AudioContext.pause(this),this._paused=!0)},play:function(){(!this._playing||this._paused)&&(this._paused?Fire.AudioContext.play(this,this._startTime):Fire.AudioContext.play(this,0),this._playing=!0,this._paused=!1)},stop:function(){this._playing&&(Fire.AudioContext.stop(this),this._playing=!1,this._paused=!1)},onLoad:function(){this._playing&&this.stop()},onEnable:function(){this.playOnLoad&&this.play()},onDisable:function(){this.stop()}});return Fire.addComponentMenu(a,"AudioSource"),a}();Fire.AudioSource=AudioSource,function(){function a(a,b,c,e){var f=!1,g=setTimeout(function(){e('The operation of decoding audio data already timeout! Audio url: "'+c+'". Set Fire.AudioContext.MaxDecodeTime to a larger value if this error often occur. See fireball-x/dev#318 for details.',null)},d.MaxDecodeTime);a.decodeAudioData(b,function(a){f||(e(null,a),clearTimeout(g))},function(a){f||(e(null,'LoadAudioClip: "'+c+'" seems to be unreachable or the file is empty. InnerMessage: '+a),clearTimeout(g))})}function b(b,c,d){var e=c&&function(d,e){e?a(Fire.nativeAC,e.response,b,c):c('LoadAudioClip: "'+b+'" seems to be unreachable or the file is empty. InnerMessage: '+d,null)};Fire.LoadManager._loadFromXHR(b,e,d,"arraybuffer")}var c=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;if(c){Fire.nativeAC||(Fire.nativeAC=new c),Fire.LoadManager.registerRawTypes("audio",b);var d={};d.MaxDecodeTime=4e3,d.getCurrentTime=function(a){return a._paused?a._startTime:a._playing?a._startTime+this.getPlayedTime(a):0},d.getPlayedTime=function(a){return(Fire.nativeAC.currentTime-a._lastPlay)*a._playbackRate},d.updateTime=function(a,b){a._lastPlay=Fire.nativeAC.currentTime,a._startTime=b,a.isPlaying&&(this.pause(a),this.play(a))},d.updateMute=function(a){a._volumeGain&&(a._volumeGain.gain.value=a.mute?-1:a.volume-1)},d.updateVolume=function(a){a._volumeGain&&(a._volumeGain.gain.value=a.volume-1)},d.updateLoop=function(a){a._buffSource&&(a._buffSource.loop=a.loop)},d.updateAudioClip=function(a){a.isPlaying&&(this.stop(a,!1),this.play(a))},d.updatePlaybackRate=function(a){this.isPaused||(this.pause(a),this.play(a))},d.pause=function(a){a._buffSource&&(a._startTime+=this.getPlayedTime(a),a._buffSource.onended=null,a._buffSource.stop(0))},d.stop=function(a,b){a._buffSource&&(b||(a._buffSource.onended=null),a._buffSource.stop(0))},d.play=function(a,b){if(a.clip&&a.clip.rawData){var c=Fire.nativeAC.createBufferSource(),d=Fire.nativeAC.createGain();c.connect(d),d.connect(Fire.nativeAC.destination),c.connect(Fire.nativeAC.destination),c.buffer=a.clip.rawData,c.loop=a.loop,c.playbackRate.value=a.playbackRate,c.onended=a._onPlayEnd.bind(a),d.gain.value=a.mute?-1:a.volume-1,a._buffSource=c,a._volumeGain=d,a._startTime=b||0,a._lastPlay=Fire.nativeAC.currentTime,c.start(0,this.getCurrentTime(a))}},d.getClipBuffer=function(a){return a.rawData},d.getClipLength=function(a){return a.rawData?a.rawData.duration:-1},d.getClipSamples=function(a){return a.rawData?a.rawData.length:-1},d.getClipChannels=function(a){return a.rawData?a.rawData.numberOfChannels:-1},d.getClipFrequency=function(a){return a.rawData?a.rawData.sampleRate:-1},Fire.AudioContext=d}}(),function(){PIXI.dontSayHello=!0;var a=function(){};PIXI.DisplayObject.prototype.updateTransform=a,PIXI.DisplayObject.prototype.displayObjectUpdateTransform=a,PIXI.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=a}();var RenderContext=function(){function a(a,b,c,d){a=a||800,b=b||600,d=d||!1;var e=!1;this.stage=new PIXI.Stage(0),this.stage.interactive=!1,this.root=this.stage,this.renderer=PIXI.autoDetectRenderer(a,b,{view:c,transparent:d,antialias:e}),this.sceneView=null,this.isSceneView=!1,this._camera=null}function b(a){if(a&&a.texture&&a.texture.image){var b=new PIXI.BaseTexture(a.texture.image),d=new PIXI.Rectangle(a.x,a.y,Math.min(b.width-a.x,a.rotatedWidth),Math.min(b.height-a.y,a.rotatedHeight));return new PIXI.Texture(b,d)}return c}var c=new PIXI.Texture(new PIXI.BaseTexture);a.initRenderer=function(a){a._renderObj=null,a._renderObjInScene=null,a._tempMatrix=new Fire.Matrix23},Object.defineProperty(a.prototype,"canvas",{get:function(){return this.renderer.view}}),Object.defineProperty(a.prototype,"width",{get:function(){return this.renderer.width},set:function(a){this.renderer.resize(a,this.renderer.height)}}),Object.defineProperty(a.prototype,"height",{get:function(){return this.renderer.height},set:function(a){this.renderer.resize(this.renderer.width,a)}}),Object.defineProperty(a.prototype,"size",{get:function(){return new Vec2(this.renderer.width,this.renderer.height)},set:function(a){this.renderer.resize(a.x,a.y)}}),Object.defineProperty(a.prototype,"background",{set:function(a){this.stage.setBackgroundColor(a.toRGBValue())}}),Object.defineProperty(a.prototype,"camera",{get:function(){return this._camera},set:function(a){this._camera=a,Fire.isValid(a)&&(a.renderContext=this)}}),a.prototype.render=function(){this.renderer.render(this.stage)},a.prototype.onRootEntityCreated=function(a){a._pixiObj=this._createNode()},a.prototype._createNode=function(){var a=new PIXI.DisplayObjectContainer;return Engine._canModifyCurrentScene&&this.root.addChild(a),a},a.prototype.onEntityRemoved=function(a){this._removeNode(a._pixiObj),a._pixiObj=null},a.prototype._removeNode=function(a){a&&a.parent&&a.parent.removeChild(a)},a.prototype.onEntityParentChanged=function(a){this._setParentNode(a._pixiObj,a._parent&&a._parent._pixiObj)},a.prototype._setParentNode=function(a,b){a&&(b?b.addChild(a):this.root.addChild(a))},a.prototype._getChildrenOffset=function(a,b){if(a){var c=this.isSceneView?a._pixiObjInScene:a._pixiObj,d=b||a._children[0];if(d){var e=this.isSceneView?d._pixiObjInScene:d._pixiObj,f=c.children.indexOf(e);return-1!==f?f:b?c.children.length:(Fire.error("%s's pixi object not contains in its pixi parent's children",d.name),-1)}return c.children.length}return 0},a.prototype.onEntityIndexChanged=function(a,b,c){var d;0===c&&b>0?d=a.getSibling(1):0===b&&c>0&&(d=a),a._pixiObj&&this._setNodeIndex(a,b,c,d)},a.prototype._setNodeIndex=function(a,b,c,d){var e=this._getChildrenOffset(a._parent,d),f=this.isSceneView?a._pixiObjInScene:a._pixiObj;if(f){var g=f.parent.children;g.splice(b+e,1);var h=c+e;h<g.length?g.splice(h,0,f):g.push(f)}},a.prototype.onSceneLaunched=function(a){this._addToScene(a)},a.prototype._addToScene=function(a){for(var b=a.entities,c=0,d=b.length;d>c;c++){var e=this.isSceneView?b[c]._pixiObjInScene:b[c]._pixiObj;e&&this.root.addChild(e)}},a.prototype.onSceneLoaded=function(a){for(var b=a.entities,c=0,d=b.length;d>c;c++)this.onEntityCreated(b[c],!1)};var d=function(a,b){a._pixiObj=new PIXI.DisplayObjectContainer,a._parent._pixiObj.addChild(a._pixiObj);for(var c=a._children,e=0,f=c.length;f>e;e++)d(c[e],b)};return a.prototype.onEntityCreated=function(a,b){a._pixiObj=new PIXI.DisplayObjectContainer,a._parent?a._parent._pixiObj.addChild(a._pixiObj):b&&this.root.addChild(a._pixiObj);for(var c=a._children,e=0,f=c.length;f>e;e++)d(c[e],this.sceneView)},a.prototype._addSprite=function(a,b){var c=new PIXI.Sprite(a);return b.addChildAt(c,0),c},a.prototype.addSprite=function(a){var c=b(a._sprite),d=!(a.entity._objFlags&HideInGame);d&&(a._renderObj=this._addSprite(c,a.entity._pixiObj)),this.updateSpriteColor(a)},a.prototype.show=function(a,b){a._renderObj&&(a._renderObj.visible=b),a._renderObjInScene&&(a._renderObjInScene.visible=b)},a.prototype.remove=function(a){this._removeNode(a._renderObj),a._renderObj=null},a.prototype.updateSpriteColor=function(a){var b=a._color.toRGBValue();a._renderObj&&(a._renderObj.tint=b)},a.prototype.updateMaterial=function(a){var c=b(a._sprite);a._renderObj&&a._renderObj.setTexture(c)},a.prototype.updateTransform=function(a,b){var c=a._tempMatrix;c.a=b.a,c.b=-b.b,c.c=-b.c,c.d=b.d,c.tx=b.tx,c.ty=this.renderer.height-b.ty;var d=Math.clamp01(a._color.a);this.isSceneView||a._renderObj&&(a._renderObj.worldTransform=c,a._renderObj.worldAlpha=d)},a}();Fire._Runtime.RenderContext=RenderContext,PIXI.BitmapText.prototype.updateTransform=function(){},Fire.BitmapFont.prototype._onPreDestroy=function(){this._uuid&&(PIXI.BitmapText.fonts[this._uuid]=null)};var defaultFace="None",tempData={face:defaultFace,size:1,chars:{},lineHeight:1},_hasPixiBitmapFont=function(a){return a?PIXI.BitmapText.fonts[a._uuid]:null};RenderContext.prototype.getTextSize=function(a){var b=!(a.entity._objFlags&HideInGame),c=0,d=0;return b&&a._renderObj?(a._renderObj.dirty&&(a._renderObj.updateText(),a._renderObj.dirty=!1),c=a._renderObj.textWidth,d=a._renderObj.textHeight):a._renderObjInScene&&(a._renderObjInScene.dirty&&(a._renderObjInScene.updateText(),a._renderObjInScene.dirty=!1),c=a._renderObjInScene.textWidth,d=a._renderObjInScene.textHeight),new Vec2(c,d)},RenderContext.prototype.setText=function(a,b){a._renderObj&&a._renderObj.setText(b),this.sceneView&&a._renderObjInScene&&a._renderObjInScene.setText(b)},RenderContext.prototype.setAlign=function(a){_setStyle(a)},RenderContext.prototype.updateBitmapFont=function(a){_registerFont(a.bitmapFont),_setStyle(a)},RenderContext.prototype.addBitmapText=function(a){_registerFont(a.bitmapFont);var b=_getStyle(a),c=!(a.entity._objFlags&HideInGame);c&&(a._renderObj=new PIXI.BitmapText(a.text,b),a.entity._pixiObj.addChildAt(a._renderObj,0)),this.sceneView&&(a._renderObjInScene=new PIXI.BitmapText(a.text,b),a.entity._pixiObjInScene.addChildAt(a._renderObjInScene,0))},RenderContext.updateBitmapTextTransform=function(a,b){var c=0,d=null,e=0,f=null,g=Engine._curRenderContext===Engine._renderContext;if(g&&a._renderObj)for(a._renderObj.dirty&&(a._renderObj.updateText(),a._renderObj.dirty=!1),d=a._renderObj.children,e=d.length;e>c;c++)f=d[c],f.worldTransform=_getNewMatrix23(f,b);else if(a._renderObjInScene)for(a._renderObjInScene.dirty&&(a._renderObjInScene.updateText(),a._renderObjInScene.dirty=!1),d=a._renderObjInScene.children,c=0,e=d.length;e>c;c++)f=d[c],f.worldTransform=_getNewMatrix23(f,b)},PIXI.Text.prototype.updateTransform=function(){};var PixiTextUtil={};RenderContext.prototype.setTextContent=function(a,b){a._renderObj&&a._renderObj.setText(b),this.sceneView&&a._renderObjInScene&&a._renderObjInScene.setText(b)},RenderContext.prototype.setTextStyle=function(a){var b=_getTextStyle(a);a._renderObj&&a._renderObj.setStyle(b),a._renderObjInScene&&a._renderObjInScene.setStyle(b)},RenderContext.prototype.addText=function(a){var b=_getTextStyle(a),c=!(a.entity._objFlags&HideInGame);c&&(a._renderObj=new PIXI.Text(a.text,b),a.entity._pixiObj.addChildAt(a._renderObj,0)),this.sceneView&&(a._renderObjInScene=new PIXI.Text(a.text,b),a.entity._pixiObjInScene.addChildAt(a._renderObjInScene,0))},RenderContext.prototype.getTextSize=function(a){var b=!(a.entity._objFlags&HideInGame),c=0,d=0;return b&&a._renderObj?(a._renderObj.dirty&&(a._renderObj.updateText(),a._renderObj.dirty=!1),c=a._renderObj.textWidth|a._renderObj._width,d=a._renderObj.textHeight|a._renderObj._height):a._renderObjInScene&&(a._renderObjInScene.dirty&&(a._renderObjInScene.updateText(),a._renderObjInScene.dirty=!1),c=a._renderObjInScene.textWidth|a._renderObjInScene._width,d=a._renderObjInScene.textHeight|a._renderObjInScene._height),new Vec2(c,d)},RenderContext.updateTextTransform=function(a,b){var c=Engine._curRenderContext===Engine._renderContext;c&&a._renderObj?(a._renderObj.dirty&&(a._renderObj.updateText(),a._renderObj.dirty=!1),a._renderObj.worldTransform=_getNewMatrix23(a._renderObj,b)):a._renderObjInScene&&(a._renderObjInScene.dirty&&(a._renderObjInScene.updateText(),a._renderObjInScene.dirty=!1),a._renderObjInScene.worldTransform=_getNewMatrix23(a._renderObjInScene,b))},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Fire),exports.Fire=Fire):"undefined"!=typeof define&&define.amd?define(Fire):(root.Fire=Fire,root.Editor=Editor)}).call(this);